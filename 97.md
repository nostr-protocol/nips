NIP-97
======

Event Recommendation Services
-----------------------------

`draft` `optional` `author:vitorpamplona`

## Abstract

Service providers want to offer event recommendations to users that subscribe to them. Specifics of the recommendation algorithms will differ between event kinds and provider implementations. This NIP describes a general framework for subscribing and performing recommendation requests.

# Recommendation Subscriptions list

A special event with kind `10020` "Recommendation Subscription List" is defined as a [NIP-16 - Replaceable Events](16.md) of public and/or private `p` tags, one for each of the subscribed services the author intends to use. Each tag entry should contain the public key for the service provider and a relay URL where the provider hosts the recommendation events. i.e., `["p", <32-bytes hex key>, <main relay URL>]`.

For example:

```json
{
  "kind": 10020,
  "tags": [
    ["p", "91cf9..4e5ca", "wss://provider1.com/"],
    ["p", "14aeb..8dad4", "wss://provider2.com/nostr"],
    ["p", "612ae..e610f", "ws://provider3.com/ws"]
  ],
  "content": "<private list>",
  ...other fields
}
```

Providers can offer as many algorithms as they want as long as they offer one per public key. 

# Recommendation Request

Clients can request recommendations at will using a kind `20020` ephemeral event. `p` tags MUST contain the group of users to make the recommendation for as well as the pub key of the service provider. `.content` MUST contain a json-serialized object with a `filters` property whose value is an array of regular NOSTR `REQ` filters ([NIP-1 - Basic Protocol](1.md)) that describe the type and constraints of the requested recommendation events.

```json
{
  "kind": 20020,
  "tags": [
    ["p", "<service pubkey>"],
    ["p", "91cf9..4e5ca", "wss://relay1.com"],
    ["p", "30223..14aeb", "wss://relay2.com"],
  ],
  "content": "{ \"filters\": [<FILTER1>, <FILTER2>, ...]}",
  ...other fields
}
```

Clients may specify several recommendation filters, i.e. `[{ "kinds": [1, 1065]}, { "#p": ["91cf9..4e5ca"], limit 200}, ...]`. Clients may include `kinds`, `tags` and other filter fields to restrict recommendation results to particular event kinds.

Providers SHOULD interpret the group of users as watching the feed together. If individual users within the group have safety filters in their profiles (imagine parents and kids), providers SHOULD apply the sum of safety filters to the response. 

Providers SHOULD interpret the recommendation request to the best of their ability and return events that they deem interesting to the requesting pubkey group. Recommendations can also include trending events as long as they are deemed of interest.

Clients MAY send requests to any provider or to just the select few the user is interested in at the moment.

# Recommendation Response

Providers respond with an ephemeral event with kind `20021`. This event MUST contain the tags to the recommended `e` event ids, `a` addresses, `p` profiles, `r` urls and/or `t` hashtags followed by a relay address to find them. An optional normalized score from 0 (least interesting) to 1 (most interesting) can be added as the 4th element of each tag. The `p` tag of the requester and the `e` tag for the requesting event SHOULD be added as well. 

```json
{
  "kind": 20021,
  "tags": [
    ["p", "<Request Pub Key>"]
    ["e", "<Request Event ID>"]
    ["e", "91cf9..4e5ca", "wss://alicerelay.com/", <score>],
    ["a", "30223:14aeb..8dad4:myblogpost", "wss://bobrelay.com/nostr", <score>],
    ["p", "612ae..e610f", "ws://carolrelay.com/ws", <score>],
    ["r", "http://nostr.com", "", <score>],
    ["t", "bitcoin", "", <score>],
  ],
  ...other fields
}
```

Clients MAY merge responses from several providers and sort the list in any way they see fit. Clients MAY verify that events returned by the provider match the specified interest in a way that suits the client's use case and MAY stop querying providers that have low precision.

Providers are not required to sustain consistency between calls. Every Recommendation Response can be a new list.

Service providers MAY exclude spam and reported events from results.

# Use Cases

Three common use cases are Kind=1 recommendations for a text-first social media app, kind-40 recommendations for public chats, and 1063 events for a picture or video feed.