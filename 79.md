# NIP-79

## Digital Contracts
-----------------

`draft` `optional` `author:vpirato` `collaborator:vitorpamplona` `collaborator:brandenespinoza`

### Abstract

This NIP proposes a standardized way to represent digital contracts, covenants, and agreements within the Nostr protocol. It defines two modes: open contracts (with full content on-chain) and private contracts (with only a verifiable hash on-chain). These contracts can be signed, verified, and referenced by other events in the protocol.

### Motivation

As digital transactions, promises, and agreements become more prevalent, it's essential to have a standardized representation of contracts within Nostr. This improved NIP aims to provide structure for both public and private contract management, enhancing privacy while maintaining verifiability.

### Specification

1. **Types**: Following [NIP-32](32.md) for label structure:
   - **Contract**: A legally binding agreement between two or more parties.
   - **Covenant**: A written promise or restriction within a contract or agreement.
   - **Agreement**: A mutual understanding between parties regarding their relative rights and responsibilities.

2. **Contract Modes**:
   - **Open**: Full contract content is stored in the `content` field in Markdown format ([NIP-23](23.md))
   - **Private**: Only the SHA256 hash of the contract is stored in the `content` field, while the actual content is shared off-chain

3. **Metadata**: Specific application metadata fields:
   - `title`: Title of the contract
   - `parties`: Parties involved
   - `signed_date`: Date it was signed
   - `expiry_date`: Expiration date, if applicable
   - `jurisdiction`: Legal jurisdiction governing the contract
   - `visibility`: Indicates if the contract is "open" or "private"
   - `format`: For private contracts, specifies the format of the original document (e.g., "text", "pdf", "docx")

4. **Timestamping with OpenTimestamps**: Following [NIP-03](03.md), OpenTimestamps creates a cryptographic proof of existence recorded on the Bitcoin blockchain.

5. **References and Linking**: Can reference other events in Nostr, such as annexes, terms and conditions, or any other relevant document.

6. **Event Kind Definitions**: Following NIP-1 conventions for regular events that should be stored by relays, we use:
   - `kind:1900` for Contract Invitation
   - `kind:1901` for Signature
   - `kind:1902` for Signing Witness
   - `kind:1903` for Contract Execution

### Contract Signing Invitation

```json
{
  "kind": 1900,
  "created_at": [Creation Timestamp],
  "content": "[Open: Full Markdown Content] OR [Private: SHA256 hash of the contract document]",
  "tags": [
    ["title", "<Contract Title>"],
    ["summary", "<Short Description>"],
    ["valid_from", "Timestamp"],
    ["valid_to", "Timestamp"],
    ["jurisdiction", "[Court Name]", "[City]", "[State]", "[Country]"],
    ["visibility", "open|private"],
    ["format", "text|pdf|docx"],  // Required for private contracts
    ["L", "nostr_contracts"],
    ["l", "Contract", "nostr_contracts"],
    ["p", "party", "<party's 1 pubkey>"],
    ["p", "party", "<party's 2 pubkey>"],
    ["p", "party", "<party's 3 pubkey>"],
    ["expiration", "<Time stamp limit to sign>"],
  ],
  "pubkey": "[Signer's Public Key]",
  "id": "[Event ID]",
}
```

### Signature

```json
{
  "kind": 1901,
  "tags": [
    [ "e", "<Contract's (kind:1900) Event ID>" ]
  ],
  "pubkey": "[Party's Public Key]",
  "created_at": [Creation Timestamp],
  "content": "",
  "id": "[Event ID]",
  "ots": "<base64-encoded OTS file data>"
}
```

### Signing Witness

```json
{
  "kind": 1902,
  "tags": [
    [ "e", "<Contract's (kind:1900) Event ID>" ],
    [ "on_behalf_of", "<Name/Title for the Contract>" ] // optional for Power Of Attorney
  ],
  "pubkey": "[Party's Public Key]",
  "created_at": [Creation Timestamp],
  "content": "<Name/Title for the Contract>",
  "id": "[Event ID]",
}
```

### Contract Execution

```json
{
  "kind": 1903,
  "created_at": [Creation Timestamp],
  "content": "<Stringified JSON of the signed kind:1900>",
  "tags": [
    ["title", "<Contract Title>"],
    ["summary", "<Short Description>"],
    ["valid_from", "Timestamp"],
    ["valid_to", "Timestamp"],
    ["jurisdiction", "[Court Name]", "[City]", "[State]", "[Country]"],
    ["visibility", "open|private"],
    ["format", "text|pdf|docx"],  // If private
    ["e", "<Contract's (kind:1900) Event ID>" ],
    ["p", "party", "<party's 1 pubkey>", "Stringified JSON of the signed kind:1901"],
    ["p", "party", "<party's 2 pubkey>", "Stringified JSON of the signed kind:1901"],
    ["p", "party", "<party's 3 pubkey>", "Stringified JSON of the signed kind:1901"],
    ["p", "witness", "<party's 4 pubkey>", "Stringified JSON of the signed kind:1902"],
    ["p", "witness", "<party's 5 pubkey>", "Stringified JSON of the signed kind:1902"],
    ["p", "witness", "<party's 6 pubkey>", "Stringified JSON of the signed kind:1902"]
  ],
  "pubkey": "[Signer's Public Key]",
  "id": "[Event ID]",
  "ots": "<base64-encoded OTS file data>"
}
```

### Private Contract Verification

For private contracts, parties can verify the authenticity by:
1. Computing the SHA256 hash of the off-chain document
2. Comparing it with the hash stored in the `content` field of the contract event
3. If the hashes match, the off-chain document is verified as the original contract

### Implementation Examples

#### Example 1: Open Contract

```json
{
  "kind": 1900,
  "created_at": 1675128000,
  "content": "# Service Agreement\n\nThis agreement is made between Party A and Party B...",
  "tags": [
    ["title", "Service Agreement"],
    ["summary", "Agreement for web development services"],
    ["valid_from", "1675128000"],
    ["valid_to", "1706664000"],
    ["jurisdiction", "Civil Court", "New York", "NY", "USA"],
    ["visibility", "open"],
    ["L", "nostr_contracts"],
    ["l", "Contract", "nostr_contracts"],
    ["p", "party", "a1b2c3..."],
    ["p", "party", "d4e5f6..."],
    ["expiration", "1675214400"],
  ],
  "pubkey": "a1b2c3...",
  "id": "0a1b2c...",
}
```

#### Example 2: Private Contract

```json
{
  "kind": 1900,
  "created_at": 1675128000,
  "content": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
  "tags": [
    ["title", "Confidential Partnership Agreement"],
    ["summary", "Partnership agreement between Companies X and Y"],
    ["valid_from", "1675128000"],
    ["valid_to", "1706664000"],
    ["jurisdiction", "Commercial Court", "London", "England", "UK"],
    ["visibility", "private"],
    ["format", "pdf"],
    ["L", "nostr_contracts"],
    ["l", "Contract", "nostr_contracts"],
    ["p", "party", "a1b2c3..."],
    ["p", "party", "d4e5f6..."],
    ["expiration", "1675214400"],
  ],
  "pubkey": "a1b2c3...",
  "id": "0a1b2c...",
}
```

### Security Considerations

- Private keys used for signing should be protected as outlined in [NIP-24](24.md)
- For private contracts, secure off-chain methods should be used to share the actual contract content
- Verification of the SHA256 hash is critical to ensure contract integrity
- Recommended to consult with legal experts when using this protocol for legally binding agreements
