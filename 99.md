NIP-99
======

Social Note
-----------

`draft` `optional` `author:arthurfranca`

Social notes are kind `31111` events. They accept plain text as `.content` just like kind `1` but are editable.

As with any parameterized replaceable event, `clients` MUST use an `a` tag instead of `e` to reference these events for reposts,
replies and such.

`Relays` MUST sort and query these events by the publication date (stored at the `d` tag) instead of by `created_at`
when the request filter includes `since`, `until` or `limit`.

`Relays` MUST validate that the publication date is less than or equal to the `created_at` value.

## Motivation

To make editable social notes that are easier to write than NIP-23, for not accepting content with Markdown syntax,
while avoiding the problem of using `created_at` field when querying or sorting by date.

## Publication Date

The `created_at` field is considered the event update date,
while the publication date is the `created_at` of the first event version, before any edits.

To make sure each event change commits to the initial `created_at` tag, its string value must be added to the `d` tag
followed by a colon as a prefix and then any other string, which can be an empty one. This way, the user must keep
the same publication date to carry the note's replies, reactions etc.

## Text Formatting

Although Markdown syntax isn't supported, it is allowed the use of single or double
[backticks](https://en.wikipedia.org/wiki/Backtick)
surrounding a text, with or without space characters between them,
for `` `italic` `` and `    ``bold``   ` content respectively,
which includes the `` ```both italic and bold``` `` formatting.

The backtick was picked because it is forbidden in URLs and isn't valid punctuation.

## NIP-22 Quirks

Social notes are expected to be edited for fixing typos and to apply minor rewrites, so not too far from the publication date.

As a suggestion, `relays` SHOULD reject edits taken place 3 hours after the publication date,
in addition to NIP-22 `created_at` limits.

## NIP-14 Subject

For greater interoperability, `clients` SHOULD make available an input box to fill the optional `subject` tag.

## Backward Compatibility

Kind `1` events are the standard for notes used on today social clients and for comments/replies on every client.

That's why one should first create a kind `1` event and then generate a kind `31111` one with the same fields and tags.

The kind `1` event must include a `m` tag with the kind `31111` event "mirror" address as `31111:<pubkey>:<d-identifier>`.

While the kind `31111` event must also include a `m` tag referencing the `id` of the corresponding kind `1` event.

Both should be published together.

Then when querying e.g. replies for the kind `31111` event, the `client` should query for the two event references.
For example:

```
["REQ", <subscription_id>,
  { kinds: [1], #e: ["e93c6095c3db1c31d15ac771f8fc5fb672f6e52cd25505099f62cd055523224f"] },
  { kinds: [31111], #a: ["31111:477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396:1689170246:"] }
]
```

### First Event Version Example:

```json
{
  "kind": 31111,
  "tags": [
    ["d", "1689170246:"],
    ["m", "f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf"]
  ],
  "content": "Check this out: https://urls.com",
  "created_at": 1689170246,
  ...other fields
}
```

### Edited Event Example:

```json
{
  "kind": 31111,
  "tags": [
    ["d", "1689170246:"],
    ["m", "f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf"]
  ],
  "content": "Check this out: https://great-urls.com", // this changed
  "created_at": 1689179999, // this changed
  ...other fields
}
```
