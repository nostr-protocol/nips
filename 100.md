NIP-XX
======

Nostr BUber
-----------

`draft` `optional`

## Summary

This NIP defines a censorship-resistant, peer-to-peer ride-hailing and delivery protocol on Nostr. It leverages Nostr events, Bitcoin Lightning payments, and reputation mechanisms to create a decentralized alternative to Uber and other centralized transportation platforms.

## Motivation

Centralized ride-hailing services extract high fees, enforce KYC, and subject users to arbitrary censorship. A Nostr-based protocol enables drivers and riders to interact directly, preserving privacy and sovereignty while maintaining safety and trust through cryptographic identity and decentralized reputation.

## Terms
* **Rider**: User requesting a ride or delivery.
* **Driver**: User providing transportation or delivery services.
* **Ride**: A trip from a pickup location to a drop-off location.
* **Delivery**: Transporting items (e.g., food) from one location to another.

## Event Kinds

| Event Kind | Name               | Description                        |
| ---------- | ------------------ | ---------------------------------- |
| 31000      | `ride_request`     | Ride request posted by rider       |
| 31001      | `ride_accept`      | Driver accepts ride                |
| 31002      | `ride_start`       | Ride started / passenger picked up |
| 31003      | `ride_complete`    | Ride completed / drop-off          |
| 31004      | `payment_invoice`  | Lightning invoice for ride payment |
| 31005      | `payment_receipt`  | Zap or payment confirmation        |
| 31050      | `ride_review`      | Post-ride rating/review event      |
| 31010      | `delivery_request` | Delivery request (food/items)      |
| 31011      | `delivery_status`  | Delivery pickup/drop-off status    |


## Event Content & Tags

### `ride_request` (31000)

**Content (JSON):**

```json
{
  "pickup": { "lat": ..., "lon": ... },
  "dropoff": { "lat": ..., "lon": ... },
  "fare_sats": 15000,
  "timestamp": 1684453830,
  "notes": "Need child seat"
}
```

**Tags:**

* `["g", <geohash>]` – coarse location
* `["d", <ride_id>]` – unique ride identifier

---

### `ride_accept` (31001)

**Content:** Optional message (e.g. `"On my way!"`)

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `ride_start` (31002)

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `ride_complete` (31003)

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `payment_invoice` (31004)

**Content:** Lightning invoice string
**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `payment_receipt` (31005)

**Content:** Zap receipt string or hash
**Tags:**

* `["e", <payment_invoice_id>]`
* `["p", <payer_pubkey>]`

---

### `ride_review` (31050)

**Content (JSON):**

```json
{
  "rating": 5,
  "comment": "Smooth ride and friendly driver!"
}
```

**Tags:**

* `["e", <ride_complete_id>]`
* `["p", <reviewed_user_pubkey>]`

---

## Identity & Authentication

* All users (riders and drivers) are identified by Nostr public keys.
* Human-readable aliases can be resolved via \[NIP-05].
* Clients may support key derivation (NIP-06) or delegated signing (NIP-46).

---

## Payments

* All payments are made via **Bitcoin Lightning**.
* Invoices are shared as Nostr events (kind 31004) or via encrypted DM.
* NIP-47 (Wallet Connect) enables integration with external wallets.
* NIP-57 (Zaps) is used for payment confirmations and tipping.
* Hold invoices (optional) simulate escrow for trustless ride completion.

---

## Discovery

* Riders publish `ride_request` to relays.
* Drivers filter requests via geotags (`"g"`), keywords, or `ride_id`.
* Optional: Scheduled rides use NIP-52 calendar tags.
* Discovery relays can specialize in ride-related events (indexing/filtering).

---

## Reputation

* Reviews are published as `ride_review` events after a ride.
* Ratings are numeric + optional comment.
* Clients aggregate ratings into scores or badges (NIP-58).
* Misconduct can be flagged using NIP-56 report events.

---

## Privacy

* Default pseudonymity (public keys).
* Ephemeral keys encouraged for per-ride privacy.
* Sensitive data shared via NIP-04/NIP-17 encrypted messages.
* No GPS logs or personal info stored on relays.
* Events can be marked as ephemeral or expire via client/relay policies.

---

## Dispute Resolution

* Immutable log of signed events provides cryptographic evidence.
* Hold invoices enable escrow-like behavior.
* Community-driven moderation via NIP-56 reports and NIP-58 trust scores.
* Optional on-chain anchors (e.g. OP\_RETURN or Taproot inscriptions) for public timestamping of disputes.

---

## Relay Expectations

Relays MAY:

* Specialize in indexing ride/delivery events.
* Offer location-based filtering or search.
* Prune ride events after completion or expiry.
* Accept ephemeral events and short-lived metadata.

Relays SHOULD:

* Support basic filtering by kind, tag (`g`, `e`, `p`), and time.
* Not store sensitive user data or private messages.

---

## Future Extensions

* Integration with NIP-53 (Live Activities) for GPS tracking.
* Dynamic route and traffic metadata sharing.
* Scheduled ride support with calendar-style invitations (NIP-52).
* Asset-backed trust scores using Taproot Assets or RGB.

---

## Security Considerations

* Sybil resistance relies on reputation, reviews, and possibly Lightning wallet verification.
* Clients should display pubkey metadata and badges to assist decision-making.
* All communication involving private or sensitive info must use encrypted DMs.

---

## Appendix: Geohash Tagging

Use `["g", <geohash>]` to index rides by location. For example:

```json
["g", "u4pruydqqvj"]
```

This allows drivers to scan for nearby requests without revealing precise GPS coordinates.

---

## Acknowledgments

* \[NIP-15] Marketplace: inspiration for listing structure
* \[Ben Arc] for BUber proposal
* Nostr Market & Plebeian Market for early experimentation

---

## References

* \[NIP-01] Nostr Event Format
* \[NIP-04] Encrypted DMs
* \[NIP-05] DNS Identifier
* \[NIP-06] Seed-Based Keys
* \[NIP-15] Marketplace Events
* \[NIP-46] Remote Signer
* \[NIP-47] Wallet Connect
* \[NIP-52] Calendar Events
* \[NIP-53] Live Activities
* \[NIP-56] Reporting
* \[NIP-57] Zaps
* \[NIP-58] Badges
* \[NIP-69] Offers
