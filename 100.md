NIP-XX
======

Nostr BUber
-----------

`draft` `optional`

## Summary

This NIP defines a censorship-resistant, peer-to-peer ride-hailing and delivery protocol on Nostr. It leverages Nostr events, Bitcoin Lightning payments, and reputation mechanisms to create a decentralized alternative to Uber and other centralized transportation platforms.

## Motivation

Centralized ride-hailing services extract high fees, enforce KYC, and subject users to arbitrary censorship. A Nostr-based protocol enables drivers and riders to interact directly, preserving privacy and sovereignty while maintaining safety and trust through cryptographic identity and decentralized reputation.

## Terms

* **Rider**: User requesting a ride or delivery.
* **Driver**: User providing transportation or delivery services.
* **Ride**: A trip from a pickup location to a drop-off location.
* **Delivery**: Transporting items (e.g., food) from one location to another.

## Event Kinds

| Event Kind | Name               | Description                        |
| ---------- | ------------------ | ---------------------------------- |
| 31000      | `ride_request`     | Ride request posted by rider       |
| 31001      | `ride_accept`      | Driver accepts ride                |
| 31002      | `ride_start`       | Ride started / passenger picked up |
| 31003      | `ride_complete`    | Ride completed / drop-off          |
| 31050      | `ride_review`      | Post-ride rating/review event      |
| 31010      | `delivery_request` | Delivery request (food/items)      |
| 31011      | `delivery_status`  | Delivery pickup/drop-off status    |
| 9734       | `zap_request`      | Lightning invoice + Nostr metadata |
| 9735       | `zap_receipt`      | Proof of payment                   |

## Event Content & Tags

### `ride_request` (31000)

**Content (JSON):**

```json
{
  "pickup": { "lat": ..., "lon": ... },
  "dropoff": { "lat": ..., "lon": ... },
  "fare_sats": 15000,
  "timestamp": 1684453830,
  "notes": "Need child seat"
}
````

The rider sets an expected fare in sats based on a local rate estimation (distance, duration, demand). This amount can be used to prefill a NIP-57 Zap Request by the driver.

**Tags:**

* `["g", <geohash>]` – coarse location used for filtering
* `["d", <ride_id>]` – unique ride identifier

---

### `ride_accept` (31001)

**Content:** Optional message (e.g. `"On my way!"`)

After accepting a ride, drivers may publish a NIP-57 Zap Request containing a Lightning invoice tied to the ride.

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `ride_start` (31002)

Marks the moment the passenger is picked up. Optionally signals the release condition for a hold invoice.

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `ride_complete` (31003)

Marks the ride as completed. Riders may then proceed to confirm payment if escrow or hold invoices were used.

**Tags:**

* `["e", <ride_request_id>]`
* `["p", <rider_pubkey>]`

---

### `zap_request` (9734)

**Content:** Optional message or description of the ride.

Used by drivers to request payment from riders using a Lightning invoice, with rich metadata.

**Tags (required for BUber context):**

* `["e", <ride_request_id>]` – links this payment to a specific ride
* `["p", <driver_pubkey>]` – pubkey of the payment recipient
* `["bolt11", <ln_invoice>]` – Lightning invoice string
* `["amount", <msats>]` – invoice amount
* `["relays", <relay_urls>]` – for context discovery
* Optionally: `["description", <purpose>]` and `["description_hash", <hash>]` for integrity (per NIP-57)

---

### `zap_receipt` (9735)

**Content:** Optional message or comment

Generated by the rider’s wallet or client after successful payment of a zap request.

**Tags:**

* `["e", <ride_request_id>]` – links payment to ride
* `["p", <rider_pubkey>]` – identifies payer
* `["bolt11", <ln_invoice>]` – original invoice (may be encrypted or hashed)

---

### `ride_review` (31050)

**Content (JSON):**

```json
{
  "rating": 5,
  "comment": "Smooth ride and friendly driver!"
}
```

Issued after a completed ride and (ideally) after payment is confirmed.

**Tags:**

* `["e", <ride_complete_id>]`
* `["p", <reviewed_user_pubkey>]`

Clients SHOULD allow `ride_review` submission only after `ride_complete` and payment confirmation (`zap_receipt`).

---

## Identity & Authentication

* All users (riders and drivers) are identified by Nostr public keys.
* Human-readable aliases can be resolved via \[NIP-05].
* Clients may support key derivation (NIP-06) or delegated signing (NIP-46).

---

## Payments

### Overview

All payments within the BUber protocol are conducted via the **Bitcoin Lightning Network**, leveraging NIP-57 (Zaps) for proof-of-payment and integration with wallet infrastructure. Payments are **peer-to-peer**, censorship-resistant, and optionally privacy-preserving.

### Protocol Flow

1. **Fare Proposal**
   The `ride_request` event includes a `fare_sats` field specifying the requested payment amount.

2. **Invoice Exchange**
   The driver responds with a `ride_accept` and then creates a Lightning invoice. This invoice is:

   * published as a **Zap Request** (per NIP-57) with a `bolt11` tag and appropriate Nostr context (ride ID), or
   * optionally sent via an encrypted DM (NIP-04/NIP-17) for privacy.

3. **Zap Request (NIP-57)**
   A `zap request` is a standard NIP-57 event that includes:

   * `["relays", <relay URLs>]`
   * `["e", <ride_request_id>]`
   * `["p", <driver_pubkey>]`
   * `["amount", <msats>]`
   * `["description", <zap purpose>]`
   * `["bolt11", <ln invoice>]`
   * optionally: `["description_hash", <hash>]`

4. **Payment Execution**
   The rider uses a compatible NIP-57 wallet to pay the invoice. The wallet:

   * validates the zap request,
   * completes the payment,
   * optionally emits a **zap receipt** (`9735`) to confirm successful payment.

5. **Zap Receipt (Payment Confirmation)**
   The payment is confirmed with a zap receipt event that includes:

   * `["e", <ride_request_id>]`
   * `["p", <rider_pubkey>]`
   * `["bolt11", <ln invoice>]`
   * optionally: comment or signature metadata

6. **Optional Escrow via Hold Invoices**
   Drivers may use hold invoices to simulate escrow. The payment is held until the ride is marked complete (`ride_complete`), and then settled. This provides additional assurance to both parties.

---

## Discovery

* Riders publish `ride_request` to relays.
* Drivers filter requests via geotags (`"g"`), keywords, or `ride_id`.
* Optional: Scheduled rides use NIP-52 calendar tags.
* Discovery relays can specialize in ride-related events (indexing/filtering).

---

## Reputation

* Reviews are published as `ride_review` events after a ride.
* Ratings are numeric + optional comment.
* Clients aggregate ratings into scores or badges (NIP-58).
* Misconduct can be flagged using NIP-56 report events.

---

## Privacy

* Default pseudonymity (public keys).
* Ephemeral keys encouraged for per-ride privacy.
* Sensitive data shared via NIP-04/NIP-17 encrypted messages.
* No GPS logs or personal info stored on relays.
* Events can be marked as ephemeral or expire via client/relay policies.

---

## Dispute Resolution

* Immutable log of signed events provides cryptographic evidence.
* Hold invoices enable escrow-like behavior.
* Community-driven moderation via NIP-56 reports and NIP-58 trust scores.
* Optional on-chain anchors (e.g. OP\_RETURN or Taproot inscriptions) for public timestamping of disputes.

---

## Relay Expectations

Relays MAY:

* Specialize in indexing ride/delivery events.
* Offer location-based filtering or search.
* Prune ride events after completion or expiry.
* Accept ephemeral events and short-lived metadata.

Relays SHOULD:

* Support basic filtering by kind, tag (`g`, `e`, `p`), and time.
* MUST support filtering by `kind` (NIP-01).
* SHOULD NOT store sensitive user data or private messages.

---

## Future Extensions

* Integration with NIP-53 (Live Activities) for GPS tracking.
* Dynamic route and traffic metadata sharing.
* Scheduled ride support with calendar-style invitations (NIP-52).
* Asset-backed trust scores using Taproot Assets or RGB.

---

## Security Considerations

* Sybil resistance relies on reputation, reviews, and possibly Lightning wallet verification.
* Clients should display pubkey metadata and badges to assist decision-making.
* All communication involving private or sensitive info must use encrypted DMs.

---

## Appendix: Geohash Tagging

Use `["g", <geohash>]` to index rides by location. For example:

```json
["g", "u4pruydqqvj"]
```

This allows drivers to scan for nearby requests without revealing precise GPS coordinates.

---

## Acknowledgments

* \[NIP-15] Marketplace: inspiration for listing structure
* \[Ben Arc] for BUber proposal
* Nostr Market & Plebeian Market for early experimentation

```
```
