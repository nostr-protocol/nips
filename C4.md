NIP-C4
======

Moderation Services
-------------------

`draft` `optional`

## Abstract

This NIP defines a way for moderation services to be implemented on Nostr.

## Moderation Service

A service should publish a kind `11984` event to define what moderation fields it provides:

```jsonc
{
  "kind": 11984,
  "tags": [
    ["filter", "nsfw", "NSFW media scanner", "binary"],
    ["filter", "spam", "Spam detector", "score"],
    ["option", "spam", "0.3", "hide"],
    ["filter", "nsfw", "true", "blur-media"]
  ],
  "content": "",
  ...
}
```

`filter` tags describe a certain filter that is available, where:
- The first value indicates the *ID* of the filter
- The second value is a human-readable name for the filter
- The third value indicates the value of the filter. Clients SHOULD not attempt to handle filters of unknown types.

Currently, only the `binary` and `score` types are defined, for boolean and floating values between 0-1 respectively, where a high result indicates flagging.

`option` tags define recommended defaults users can use, where:
- The first value indicates the filter ID
- The second value indicates the threshold (for a score) or `true` for binary.
- The third value includes the recommended action. The defined types are:
  - `hide`: The message is hidden unless the user explicitly wants to show spam replies (in a dedicated section)
  - `collapse`: The message is collapsed as "potentially spam".
  - `blur-media`: Media is blurred.

A fully-empty kind 11984 event should be treated the same as there being none at all.

## Moderation Result

A moderation service publishes a moderation result for each event with kind `31984` in the following format:
```jsonc
{
  "kind": 31984,
  "tags": [
    ["d", "14f34e7e9b21da4a2f4d8299010a2febb76e9fc275033ce9e6d0ddf0d5d333fa"]
    ["filter", "spam", "0.5"]
  ],
  "content": "",
  ...
}
```

The `d` tag indicates the ID of the event being moderated. One or more `filter` tags are provided, where the first element indicates the filter ID, and the second indicates the value provided by the filter.

Clients SHOULD assume a non-existent event as there being no flags.

If an event exists but is missing certain filters, the filter should be considered *in progress* and the client should wait for a given period or the filter value to be available in a new event (by keeping open the subscription) before taking action.

## Relay-based Services

To allow for relays implementing moderation functionality on-demand, clients SHOULD format their filters for moderation events in the following way:
- The `kinds` filter is set to `[31984]`
- One or more `authors` are used to filter the REQ
- One or more `#d` are used to filter the REQ
- No other restrictions exist including `limit`
