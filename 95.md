NIP-95
======

Relay File Storage
------------------

`draft` `optional`

This NIP defines a way to store binary data on relays. It supports parallel uploads and resumable downloads.

## Upload

To upload a file, first client must convert its bytes to base64. It may do it in chunks made of multiples of 3 bytes or in one go.
The base64 data will be used on the `.content` field of one or more `kind:1064` events to be uploaded to a relay.

The chunk events may be sent on separate websockets connections for parallel uploads.

## Event

An event of `kind:1064` represents a file chunk. A client may choose to split a file
into multiple chunks or use a single event.

The event `.pubkey` is NOT the uploader's one but a randomly generated pubkey. All chunks
use the same pubkey. The pubkey MUST NOT be reused on events other than the
`kind:1064` event set of a single file.
**The pubkey is what is used to uniquely identify the file made of a set of chunk events**

The event `.content` is the base64-encoded file data.

It has a `c` tag. Its first falue is the chunk number while the second one is the total number of chunks.
The client can use the `c` tag to ask for missing chunks when resuming a download.

Example:

```js
{
  "id": "<id>",
  "pubkey": "<same-random-pubkey-for-all-event-chunks>"
  "kind": 1064,
  "tags": [
    ["c", "5", "20"] // required; this is the 5th chunk of a total of 20
  ],
  "content": "<base64-chunk>",
  "created_at": <timestamp>,
  "sig": "<signature>"
}
```

## Metadata

Metadata should be added using [NIP-94](94.md) or other metadata-related NIP.

## File Relay

Client should upload to user's "file relays", which use the [NIP-65](65.md) `f` flag.
When downloading a file uploaded with this NIP, it should search on the uploader's "file relays".

## Download

This NIP introduces a NIP-94 `f` tag filled with the `kind:1064` pubkey, uniquely identifying the file,
and a `nip95u` tag set to the pubkey of the user who uploaded the file.

Upon seeing such tags, in order to download the file, client should search for `kind:1064` events
by author (`f` tag value) on the `nip95u` uploader's "file relays".

It must join the `.content` values from all the `kind:1064` events then convert it to bytes to recreate the file.

## nfile Entity

A [NIP-19](19.md) `nfile` bech32-encoded entity may be embedded directly on notes using a [NIP-21](21.md) URL.
It translates to two values:

1) The `kind:1064` set's pubkey, identifying the file;
2) The uploader's pubkey, to be able to find the right "file relays" to download the file from.
