# NIP-5F
========

Remote Signing via Unix Domain Sockets
--------------------------------------

`draft` `optional`

This NIP defines a protocol for communication between Nostr clients and local remote signers using Unix domain sockets. This enables secure, local-only signing without exposing private keys to client applications.

Unix domain sockets provide several advantages for local signing:

1. They're local-only by design, preventing network exposure of sensitive operations
2. They offer lower latency than network-based solutions
3. They work without internet connectivity

## Protocol Overview

This protocol defines how a Nostr client can request event signing from a local signer service through Unix domain sockets.

### Socket Location

The socket should be located at:

```
$HOME/.local/share/nostr/signer.sock
```

### Connection Handshake

Upon connecting to the socket, the signer should send a handshake message:

```json
{
  "name": "nostr-signer",
  "supported_methods": ["get_public_key", "sign_event"]
}
```

The client should respond with:

```
{
  "client": "client-name",
}
```

Request Format
All requests follow this JSON-RPC-like format:

```json
{
  "id": "<random_string>",
  "method": "<method_name>",
  "params": [<array_of_parameters>]
}
```

- `id`: A random string that will be included in the response to match requests and responses
- `method`: The name of the method being called
- `params`: An array of parameters specific to the method

Response Format

All responses follow this format:

```json
{
  "id": "<same_id_from_request>",
  "result": <result_value>,
  "error": null
}
```

Or in case of an error:

```json
{
  "id": "<same_id_from_request>",
  "result": null,
  "error": {
    "code": <error_code>,
    "message": "<error_message>"
  }
}
```

### Methods

`get_public_key`

Request:

```json
{
  "id": "req123",
  "method": "get_public_key",
  "params": []
}
```

Response:

```json
{
  "id": "req123",
  "result": "<32-byte-hex-encoded-pubkey>",
  "error": null
}
```

`sign_event`

Request:

```json
{
  "id": "req124",
  "method": "sign_event",
  "params": [{
    "kind": <event_kind>,
    "content": "<content>",
    "tags": [<tags>],
    "created_at": <timestamp>
  },
  "pubkey": "<32-byte-hex-encoded-pubkey>",
  ]
}
```

Response:

```json
{
  "id": "req124",
  "result": {
    "id": "<calculated-id>",
    "pubkey": "<pubkey>",
    "kind": <event_kind>,
    "content": "<content>",
    "tags": [<tags>],
    "created_at": <timestamp>,
    "sig": "<signature>"
  },
  "error": null
}
```

### Optional Methods

Implementations MAY support these additional methods:

`nip44_encrypt`

Request:

```json
{
  "id": "req125",
  "method": "nip44_encrypt",
  "params": ["<pubkey>", "<plaintext>"]
}
```

Response:

```json
{
  "id": "req125",
  "result": "<nip44_ciphertext>",
  "error": null
}
```

`nip44_decrypt`

Request:

```json
{
  "id": "req126",
  "method": "nip44_decrypt",
  "params": ["<pubkey>", "<nip44_ciphertext>"]
}
```

Response:

```json
{
  "id": "req126",
  "result": "<plaintext>",
  "error": null
}
```

### Multiple Key Support

Signers supporting multiple keys SHOULD implement an additional method:

`list_public_keys`

Request:

```json
{
  "id": "req127",
  "method": "list_public_keys",
  "params": []
}
```

Response:

```json
{
  "id": "req127",
  "result": [
    {
      "pubkey": "<pubkey1>",
      "name": "Main Identity"
    },
    {
      "pubkey": "<pubkey2>",
      "name": "Secondary Identity"
    }
  ],
  "error": null
}
```

## Error Handling

Standard error codes:

- 1: Invalid request format
- 2: Method not supported
- 3: Invalid parameters
- 4: Key not found
- 5: User declined to sign
- 10: Internal error
