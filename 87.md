NIP-87
======

Nostr Service Discoverability
-----------------------------

`draft` `optional`

This NIP describes a standardized way to discover various Nostr services, their capabilities, and people who recommend them. It defines `kind:38000` as a general service recommendation event, and specific event kinds for different service types.

## Rationale

Nostr's discoverability and transparent event interaction is one of its most interesting/novel mechanics. This NIP provides a unified framework for users to discover various services recommended by other users and to interact with them.

## General Framework

### Parties involved

There are three actors in the service discovery workflow:

* A service operator, who announces their service and its capabilities
  * Publishes a service-specific event kind, detailing how to connect to it and its capabilities
* User A, who recommends a service
  * Publishes `kind:38000` with appropriate tags
* User B, who seeks a recommendation for a service
  * Queries for `kind:38000` with filters, and based on results, queries for service-specific events

### Service Recommendation Event

The recommendation event uses `kind:38000` as a general-purpose service recommendation event. Different services are distinguished by the `k` tag which specifies the event kind of the service being recommended.

```json
{
  "kind": 38000,
  "pubkey": <recommender-user-pubkey>,
  "tags": [
    ["k", "<service-event-kind>"],
    ["d", "<d-identifier>"],
    ["u", "<service-connection-url>"],
    ["a", "<service-event-kind>:<service-pubkey>:<d-identifier>", "wss://relay"]
  ],
  "content": "Review or description of the service"
}
```

The recommendation event is a parameterized-replaceable event so that a user can change/edit their recommendation without creating a new event.

#### Required Tags

* `k` - The kind number of the service event being recommended
* `d` - The `d` identifier of the service event being recommended

#### Optional Tags

* `u` - URLs or connection strings for the service (can have multiple)
* `a` - Reference to the service's announcement event with relay hints

## Service Types

### Ecash Mints

Ecash mints use two event kinds:

* `kind:38172` - Cashu mints
* `kind:38173` - Fedimints

#### Cashu Mint Information (`kind:38172`)

Cashu mints SHOULD publish `kind:38172` events to announce their capabilities and how to connect to them.

```json
{
  "kind": 38172,
  "pubkey": "<application-pubkey>",
  "content": "<optional-kind:0-style-metadata>",
  "tags": [
    ["d", "<cashu-mint-pubkey>"],
    ["u", "https://cashu.example.com"],
    ["nuts", "1,2,3,4,5,6,7"],
    ["n", "mainnet"]
  ]
}
```

Tags:

* `d` - The mint's pubkey (found when querying `/v1/info`)
* `u` - URL to the cashu mint
* `nuts` - Supported NUT specifications
* `n` - Network (`mainnet`, `testnet`, `signet`, or `regtest`)

#### Fedimint Information (`kind:38173`)

Fedimints SHOULD publish `kind:38173` events to announce their capabilities and how to connect to them.

```json
{
  "kind": 38173,
  "pubkey": "<application-pubkey>",
  "content": "<optional-kind:0-style-metadata>",
  "tags": [
    ["d", "<federation-id>"],
    ["u", "fed11abc.."],
    ["u", "fed11xyz.."],
    ["modules", "lightning,wallet,mint"],
    ["n", "signet"]
  ]
}
```

Tags:

* `d` - The federation ID
* `u` - Fedimint invite codes (can have multiple)
* `modules` - Supported modules
* `n` - Network (`mainnet`, `testnet`, `signet`, or `regtest`)

### Routstr Providers

Routstr provides a way to access AI models through Nostr, offering privacy-preserving access to various language models. Routstr providers use `kind:38421`.

#### Routstr Provider Information (`kind:38421`)

Routstr providers SHOULD publish `kind:38421` events to announce their capabilities and how to connect to them.

```json
{
  "kind": 38421,
  "pubkey": "<routstr-provider-pubkey>",
  "content": "<optional-kind:0-style-metadata>",
  "tags": [
    ["d", "<unique-provider-identifier>"],
    ["u", "https://api.routstr.com/"],
    ["u", "fhxpl22punqhmmgcldhbusmxrmxa36gx2hbrr7yz4trq5wwthwbxucqd.onion"],
    ["models", "gpt-4o-mini", "gpt-4o", "claude-3-5-sonnet", "claude-3-5-haiku", "mistral-large", "llama-3.3-70b"],
    ["mint", "https://mint.example.com"],
    ["version", "0.0.1"]
  ]
}
```

Tags:

* `d` - Unique identifier for the provider instance (e.g., domain name)
* `u` - URLs to connect to the Routstr provider (HTTP endpoints)
* `models` - List of supported AI models
* `mint` - (Optional) Associated ecash mint for payments
* `version` - Provider software version

#### Model Capabilities

Providers MAY include additional tags to describe model-specific capabilities:

```json
{
  "tags": [
    ["model-cap", "gpt-4o", "max_tokens:128000,vision:true,tools:true"],
    ["model-cap", "claude-3-5-sonnet", "max_tokens:200000,vision:true,tools:true"],
    ["model-cap", "llama-3.3-70b", "max_tokens:32768,vision:false,tools:true"]
  ]
}
```

## Common Patterns

### Content Field

For all service announcement events, the `content` field is an optional `metadata`-like stringified JSON object, as described in NIP-01. This content is useful when the pubkey creating the service event is not a normal user. If `content` is empty, the `kind:0` of the pubkey should be used to display service information (e.g. name, picture, web, LUD16, etc.)

### Discovery Examples

#### Example: User A recommends a Cashu mint

```json
{
  "kind": 38000,
  "tags": [
    ["k", "38172"],
    ["d", "<cashu-mint-pubkey>"],
    ["u", "https://cashu.example.com"],
    ["a", "38172:<cashu-mint-pubkey>:<cashu-mint-pubkey>", "wss://relay1"]
  ],
  "content": "Reliable mint with low fees"
}
```

#### Example: User A recommends a Routstr provider

```json
{
  "kind": 38000,
  "tags": [
    ["k", "38421"],
    ["d", "api.routstr.com"],
    ["u", "https://api.routstr.com/"],
    ["u", "fhxpl22punqhmmgcldhbusmxrmxa36gx2hbrr7yz4trq5wwthwbxucqd.onion"],
    ["a", "38421:routstr-provider-pubkey:api.routstr.com", "wss://relay1"]
  ],
  "content": "Fast and reliable AI proxy with great model selection"
}
```

#### Example: User B finds services

User B's client queries for `kind:38000` events, filtering by the service kind they're interested in:

```json
// Finding ecash mints
["REQ", <id>, [{ "kinds": [38000], "authors": [<user>, <users-contact-list>], "#k": ["38172", "38173"] }]]

// Finding Routstr providers
["REQ", <id>, [{ "kinds": [38000], "authors": [<user>, <users-contact-list>], "#k": ["38421"] }]]
```

After finding recommendations, the client queries for the specific service events:

```json
// Query for specific service
["REQ", <id>, [{ "kinds": [38421], "#d": ["api.routstr.com"] }]]
```

### Alternative Direct Query

Users might choose to query directly for service events. Clients SHOULD be careful doing this and use spam-prevention mechanisms or query high-quality restricted relays to avoid directing users to malicious services.

```json
// Direct query for Routstr providers
["REQ", <id>, [{ "kinds": [38421] }]]

// Direct query for Cashu mints
["REQ", <id>, [{ "kinds": [38172] }]]
```

## Future Service Types

This framework can be extended to support additional service types by:

1. Defining a new event kind for the service
2. Specifying required and optional tags for that service type
3. Using `kind:38000` with the appropriate `k` tag for recommendations

Service operators should follow the patterns established above, including:

* Using parameterized-replaceable events
* Including connection information in `u` tags
* Providing capability information through specific tags
* Using the `content` field for metadata when appropriate
