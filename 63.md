# NIP-63

## Physical Space Rentals

`draft` `optional`

This NIP defines a system for managing rentable physical spaces on Nostr. It supports diverse use cases including RV parks, parking lots, storage units, hotel rooms, campgrounds, event venues, boat slips, and co-working spaces. It builds on [NIP-41](41.md) (Physical Locations) and extends [NIP-52](52.md) (Calendar Events) for reservations.

---

## 1. Overview

Physical space rental requires several interconnected event types:

| Kind    | Name                  | Description                                                            |
| ------- | --------------------- | ---------------------------------------------------------------------- |
| `33000` | Physical Location     | The venue/property (defined in NIP-41)                                 |
| `33001` | Space Class           | A category of similar spaces (e.g., "Premium Sites", "Standard Rooms") |
| `33002` | Space                 | An individual rentable unit                                            |
| `33003` | Availability Snapshot | Efficient availability data for a space class                          |
| `31922` | Reservation           | A booking (extends NIP-52 date-based calendar event)                   |
| `33012` | Pricing Configuration | Rates, fees, taxes for a location                                      |
| `33013` | Rental Policy         | Rules for check-in, cancellation, etc.                                 |

All events are **addressable** (parameterized replaceable) per NIP-01, using `["d", "<uuid>"]` tags. Identifiers MUST be UUIDs (v4 recommended) to ensure global uniqueness and avoid collisions.

---

## 2. Relationships

Events form a hierarchy via `a` tags referencing parent events:

```
Physical Location (33000)
├── Space Class (33001)
│   ├── Space (33002)
│   └── Availability Snapshot (33003)
├── Pricing Configuration (33012)
├── Rental Policy (33013)
└── Reservation (31922)
    └── references Space Class and Space
```

The `a` tag format follows NIP-01: `["a", "<kind>:<pubkey>:<d-tag>", "<relay-hint>"]`

---

## 3. Event Definitions

### 3.1. Space Class (kind `33001`)

A **Space Class** groups similar rentable units that share attributes (size, amenities, pricing tier).

#### Required Tags

| Tag    | Description                  | Example                                         |
| ------ | ---------------------------- | ----------------------------------------------- |
| `d`    | UUID identifier              | `["d", "b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"]` |
| `a`    | Reference to parent location | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `name` | Display name                 | `["name", "Premium Sites"]`                     |

#### Recommended Tags

| Tag           | Description                    | Example                                                 |
| ------------- | ------------------------------ | ------------------------------------------------------- |
| `L`           | Label namespace                | `["L", "space-class"]`                                  |
| `l`           | Type label (industry-specific) | `["l", "rv-site", "space-class"]`                       |
| `description` | Human-readable description     | `["description", "Our best sites with full amenities"]` |
| `capacity`    | Max occupants                  | `["capacity", "6"]`                                     |
| `base_price`  | Base rate per period           | `["base_price", "USD", "65"]`                           |
| `image`       | Photo URL (multiple allowed)   | `["image", "https://..."]`                              |
| `t`           | Amenity/feature tags           | `["t", "wifi"], ["t", "pool-access"]`                   |

#### Optional Dimension Tags

| Tag          | Description           | Example                      |
| ------------ | --------------------- | ---------------------------- |
| `max_length` | Max length            | `["max_length", "ft", "45"]` |
| `max_width`  | Max width             | `["max_width", "ft", "20"]`  |
| `max_height` | Height clearance      | `["max_height", "ft", "14"]` |
| `area`       | Square footage/meters | `["area", "sqft", "200"]`    |

#### Content

Plain text description or empty.

#### Example (RV Park)

```json
{
  "kind": 33001,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["name", "Full Hookup 50 Amp Sites"],
    ["L", "space-class"],
    ["l", "rv-site", "space-class"],
    ["capacity", "6"],
    ["max_length", "ft", "45"],
    ["max_width", "ft", "20"],
    ["base_price", "USD", "65"],
    ["t", "50-amp"],
    ["t", "full-hookup"],
    ["t", "water"],
    ["t", "sewer"],
    ["image", "https://example.com/site-photo.jpg"]
  ],
  "content": "Premium back-in sites with full hookups"
}
```

---

### 3.2. Space (kind `33002`)

An individual rentable unit within a Space Class.

#### Required Tags

| Tag    | Description                  | Example                                         |
| ------ | ---------------------------- | ----------------------------------------------- |
| `d`    | UUID identifier              | `["d", "c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f"]` |
| `a`    | Reference to parent location | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `a`    | Reference to space class     | `["a", "33001:<pubkey>:<class-uuid>"]`          |
| `name` | Display name                 | `["name", "Site 42"]`                           |

#### Recommended Tags

| Tag      | Description                  | Example                               |
| -------- | ---------------------------- | ------------------------------------- |
| `status` | Availability status          | `["status", "available"]`             |
| `image`  | Photo URL (multiple allowed) | `["image", "https://..."]`            |
| `t`      | Unit-specific features       | `["t", "corner-lot"], ["t", "shade"]` |

#### Optional Dimension Tags

| Tag      | Description           | Example                   |
| -------- | --------------------- | ------------------------- |
| `width`  | Actual width          | `["width", "ft", "20"]`   |
| `length` | Actual length         | `["length", "ft", "45"]`  |
| `height` | Height clearance      | `["height", "ft", "14"]`  |
| `area`   | Square footage/meters | `["area", "sqft", "150"]` |

#### Status Values

- `available` - Can be booked
- `maintenance` - Temporarily unavailable
- `inactive` - Not accepting bookings

#### Content

Plain text notes or empty.

#### Example (RV Park)

```json
{
  "kind": 33002,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["a", "33001:<pubkey>:b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"],
    ["name", "Site 42"],
    ["status", "available"],
    ["width", "ft", "20"],
    ["length", "ft", "45"],
    ["t", "corner-lot"],
    ["t", "shade"]
  ],
  "content": "Corner lot with extra shade"
}
```

---

### 3.3. Availability Snapshot (kind `33003`)

Pre-computed availability for efficient calendar queries. Published per Space Class.

#### Required Tags

| Tag | Description                  | Example                                         |
| --- | ---------------------------- | ----------------------------------------------- |
| `d` | UUID identifier              | `["d", "d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a"]` |
| `a` | Reference to parent location | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `a` | Reference to space class     | `["a", "33001:<pubkey>:<class-uuid>"]`          |

#### Recommended Tags

| Tag                    | Description                 | Example                                      |
| ---------------------- | --------------------------- | -------------------------------------------- |
| `forward_looking_days` | Number of days included     | `["forward_looking_days", "90"]`             |
| `availability_on_day`  | Date and count (repeatable) | `["availability_on_day", "2025-01-15", "5"]` |

#### Content

Empty. All data is stored in tags for efficient filtering.

#### Example

```json
{
  "kind": 33003,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "d4e5f6a7-b8c9-4d0e-1f2a-3b4c5d6e7f8a"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["a", "33001:<pubkey>:b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"],
    ["forward_looking_days", "90"],
    ["availability_on_day", "2025-01-15", "5"],
    ["availability_on_day", "2025-01-16", "4"],
    ["availability_on_day", "2025-01-17", "4"],
    ["availability_on_day", "2025-01-18", "2"],
    ["availability_on_day", "2025-01-19", "5"]
  ],
  "content": ""
}
```

---

### 3.4. Reservation (kind `31922`)

A booking record. Uses NIP-52's date-based calendar event kind for interoperability.

#### Required Tags

| Tag     | Description                               | Example                                         |
| ------- | ----------------------------------------- | ----------------------------------------------- |
| `d`     | UUID identifier (reservation ID)          | `["d", "e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b"]` |
| `a`     | Reference to parent location              | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `a`     | Reference to space class                  | `["a", "33001:<pubkey>:<class-uuid>"]`          |
| `a`     | Reference to assigned space               | `["a", "33002:<pubkey>:<space-uuid>"]`          |
| `start` | Check-in date (ISO 8601 date)             | `["start", "2025-02-01"]`                       |
| `end`   | Check-out date (ISO 8601 date, exclusive) | `["end", "2025-02-05"]`                         |

#### Recommended Tags

| Tag      | Description        | Example                           |
| -------- | ------------------ | --------------------------------- |
| `title`  | Display title      | `["title", "Smith (2025-02-01)"]` |
| `status` | Reservation status | `["status", "confirmed"]`         |

#### Status Values

- `hold` - Pending payment/confirmation
- `confirmed` - Paid and confirmed
- `cancelled` - Cancelled by guest or operator

#### Content (Encrypted)

Guest details and payment information SHOULD be encrypted using [NIP-44](44.md) to the operator's pubkey. The encrypted payload is a JSON array of tuples:

```json
[
  ["email", "guest@example.com"],
  ["phone", "+1234567890"],
  ["first_name", "John"],
  ["last_name", "Smith"],
  ["guest_count", "4"],
  ["notes", "Late arrival after 8pm"],
  ["payment_provider", "stripe"],
  ["payment_intent_id", "pi_xxx"],
  ["original_amount_cents", "45000"],
  ["original_currency", "USD"],
  ["refund_token", "secret-for-self-service-cancel"],
  ["receipt_lines", "[{\"label\":\"Nightly Rate\",\"total\":300}]"],
  ["receipt_subtotal", "300"],
  ["receipt_taxes", "33"],
  ["meta", "custom_key", "custom_value"]
]
```

#### Example

```json
{
  "kind": 31922,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "e5f6a7b8-c9d0-4e1f-2a3b-4c5d6e7f8a9b"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["a", "33001:<pubkey>:b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e"],
    ["a", "33002:<pubkey>:c3d4e5f6-a7b8-4c9d-0e1f-2a3b4c5d6e7f"],
    ["title", "Smith (2025-02-01)"],
    ["start", "2025-02-01"],
    ["end", "2025-02-05"],
    ["status", "confirmed"]
  ],
  "content": "<NIP-44 encrypted tuple array>"
}
```

---

### 3.5. Pricing Configuration (kind `33012`)

Defines rates, fees, and taxes for a location. All amounts use the currency specified in the `currency` tag.

#### Required Tags

| Tag        | Description                  | Example                                         |
| ---------- | ---------------------------- | ----------------------------------------------- |
| `d`        | UUID identifier              | `["d", "f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c"]` |
| `a`        | Reference to parent location | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `currency` | ISO 4217 currency code       | `["currency", "USD"]`                           |

#### Scope Tags

| Tag     | Description    | Example                                             |
| ------- | -------------- | --------------------------------------------------- |
| `scope` | Location-wide  | `["scope", "location", "<location-id>"]`            |
| `scope` | Class-specific | `["scope", "class", "<location-id>", "<class-id>"]` |

#### Season Tags (repeatable)

| Tag      | Description                | Example                                          |
| -------- | -------------------------- | ------------------------------------------------ |
| `season` | Date range with multiplier | `["season", "2025-11-15", "2025-04-15", "1.25"]` |

#### Occupancy Tags

| Tag         | Description      | Example                              |
| ----------- | ---------------- | ------------------------------------ |
| `occupancy` | Extra adult rate | `["occupancy", "extra-adult", "15"]` |
| `occupancy` | Extra child rate | `["occupancy", "extra-child", "10"]` |

#### Fee Tags (repeatable)

| Tag   | Description | Example                                                            |
| ----- | ----------- | ------------------------------------------------------------------ |
| `fee` | Generic fee | `["fee", "Cleaning Fee", "one-time", "25", "true", "reservation"]` |

Fee format: `["fee", "<label>", "<type>", "<amount>", "<taxable?>", "<applies-to?>"]`

Types: `one-time`, `per-night`, `per-stay`
Applies-to: `reservation`, `guest`

#### Tax Tags (repeatable)

| Tag         | Description    | Example                             |
| ----------- | -------------- | ----------------------------------- |
| `tax_pct`   | Percentage tax | `["tax_pct", "State Tax", "6"]`     |
| `tax_fixed` | Fixed tax      | `["tax_fixed", "Tourism Fee", "5"]` |

#### Content

Plain text notes or empty.

#### Example

```json
{
  "kind": 33012,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "f6a7b8c9-d0e1-4f2a-3b4c-5d6e7f8a9b0c"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["currency", "USD"],
    ["scope", "location", "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["season", "2025-11-15", "2025-04-15", "1.25"],
    ["occupancy", "extra-adult", "15"],
    ["occupancy", "extra-child", "10"],
    ["fee", "Cleaning Fee", "one-time", "25", "true"],
    ["tax_pct", "State Tax", "6"],
    ["tax_pct", "Tourism Tax", "5"]
  ],
  "content": ""
}
```

---

### 3.6. Rental Policy (kind `33013`)

Operational rules for the location.

#### Required Tags

| Tag | Description                    | Example                                         |
| --- | ------------------------------ | ----------------------------------------------- |
| `d` | UUID identifier                | `["d", "a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d"]` |
| `a` | Reference to parent location   | `["a", "33000:<pubkey>:<location-uuid>"]`       |
| `L` | Label namespace                | `["L", "policy"]`                               |
| `l` | Type label (industry-specific) | `["l", "rental", "policy"]`                     |

#### Scope Tags

| Tag     | Description                     | Example                                  |
| ------- | ------------------------------- | ---------------------------------------- |
| `scope` | Location-wide or class-specific | `["scope", "location", "<location-id>"]` |

#### Stay Duration Tags

| Tag    | Description          | Example                         |
| ------ | -------------------- | ------------------------------- |
| `stay` | Minimum nights/hours | `["stay", "min-nights", "2"]`   |
| `stay` | Maximum nights/hours | `["stay", "max-nights", "180"]` |

#### Lead Time Tags

| Tag         | Description               | Example                            |
| ----------- | ------------------------- | ---------------------------------- |
| `lead_time` | Min hours before check-in | `["lead_time", "min-hours", "24"]` |
| `lead_time` | Max days in advance       | `["lead_time", "max-days", "365"]` |

#### Arrival Tags

| Tag       | Description    | Example                                   |
| --------- | -------------- | ----------------------------------------- |
| `arrival` | Check-in time  | `["arrival", "checkin-after", "15:00"]`   |
| `arrival` | Check-out time | `["arrival", "checkout-before", "11:00"]` |

#### Occupancy Tags

| Tag                | Description          | Example                                      |
| ------------------ | -------------------- | -------------------------------------------- |
| `occupancy_policy` | Base included guests | `["occupancy_policy", "base-included", "2"]` |
| `occupancy_policy` | Max guests           | `["occupancy_policy", "max-guests", "8"]`    |

#### Cancellation Tags

| Tag            | Description              | Example                                        |
| -------------- | ------------------------ | ---------------------------------------------- |
| `cancellation` | Free cancellation window | `["cancellation", "free-within-hours", "168"]` |
| `cancellation` | Cancellation fee         | `["cancellation", "fee", "USD", "25"]`         |

#### Blackout Tags (repeatable)

| Tag        | Description   | Example                                                       |
| ---------- | ------------- | ------------------------------------------------------------- |
| `blackout` | Blocked dates | `["blackout", "2025-12-24", "2025-12-26", "Holiday closure"]` |

#### Identity Tags

| Tag           | Description | Example                      |
| ------------- | ----------- | ---------------------------- |
| `age`         | Minimum age | `["age", "min-years", "21"]` |
| `id_required` | ID required | `["id_required", "true"]`    |

#### Content

Plain text notes/rules or empty.

#### Example

```json
{
  "kind": 33013,
  "pubkey": "<operator-pubkey>",
  "tags": [
    ["d", "a7b8c9d0-e1f2-4a3b-4c5d-6e7f8a9b0c1d"],
    ["a", "33000:<pubkey>:a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["L", "policy"],
    ["l", "rental", "policy"],
    ["scope", "location", "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d"],
    ["stay", "min-nights", "2"],
    ["stay", "max-nights", "180"],
    ["arrival", "checkin-after", "15:00"],
    ["arrival", "checkout-before", "11:00"],
    ["occupancy_policy", "base-included", "2"],
    ["occupancy_policy", "max-guests", "8"],
    ["cancellation", "free-within-hours", "168"],
    ["cancellation", "fee", "USD", "25"],
    ["blackout", "2025-12-24", "2025-12-26", "Holiday closure"]
  ],
  "content": "Check in at the office. After hours, use the self-service kiosk."
}
```

---

## 4. Querying

### 4.1. Fetch all data for a location

```json
{
  "kinds": [33000, 33001, 33002, 33003, 33012, 33013, 31922],
  "authors": ["<operator-pubkey>"],
  "#a": ["33000:<operator-pubkey>:<location-uuid>"]
}
```

### 4.2. Fetch availability for booking UI

```json
{
  "kinds": [33001, 33003],
  "authors": ["<operator-pubkey>"],
  "#a": ["33000:<operator-pubkey>:<location-uuid>"]
}
```

### 4.3. Fetch reservations for a date range

```json
{
  "kinds": [31922],
  "authors": ["<operator-pubkey>"],
  "#a": ["33000:<operator-pubkey>:<location-uuid>"],
  "since": 1735689600
}
```

---

## 5. Availability Calculation

Clients calculate real-time availability by:

1. Fetching the Availability Snapshot (kind `33003`) for quick display
2. Fetching recent Reservations (kind `31922`) since the snapshot was generated
3. Adjusting counts based on reservations with `status` != `cancelled`

The snapshot is a cache optimization. Operators SHOULD regenerate snapshots when reservations change.

---

## 6. Reservation Flow

### 6.1. Guest booking flow

1. Client fetches location, space classes, and availability
2. Guest selects dates and space class
3. Client creates a `hold` reservation (kind `31922`)
4. Guest completes payment
5. Client or operator updates reservation to `confirmed`
6. Operator regenerates availability snapshot

### 6.2. Cancellation flow

1. Guest requests cancellation (using `refund_token` from encrypted content)
2. Operator verifies token and applies cancellation policy
3. Operator updates reservation `status` to `cancelled`
4. Operator regenerates availability snapshot

---

## 7. Privacy Considerations

- Guest PII (name, email, phone, payment details) MUST be encrypted with NIP-44
- Only the operator (pubkey author) can decrypt reservation details
- Public tags (`start`, `end`, `status`) enable availability calculation without exposing guest data
- The `refund_token` in encrypted content enables secure self-service cancellation

---

## 8. Implementation Notes

### 8.1. Date handling

- All dates use ISO 8601 format (`YYYY-MM-DD`)
- `start` is the check-in date (inclusive)
- `end` is the check-out date (exclusive) — a 3-night stay from Jan 1-4 has `start=2025-01-01`, `end=2025-01-04`
- Times in policies use 24-hour format (`HH:MM`)

### 8.2. Currency and amounts

- All amounts in a Pricing Configuration use the `currency` tag as the unit
- Currency codes follow ISO 4217 (USD, EUR, BTC, etc.)
- Amounts are stored as strings in tags to preserve precision

### 8.3. Dimension format

Dimensions use the format `["tag_name", "<unit>", "<value>"]` where:

- Unit is first (e.g., "ft", "m", "sqft", "sqm")
- Value is second (numeric string)

### 8.4. Space type labels

Use the `l` tag to indicate space type within the `space-class` namespace:

| Use Case   | Label Example                          |
| ---------- | -------------------------------------- |
| RV Parks   | `["l", "rv-site", "space-class"]`      |
| Hotels     | `["l", "hotel-room", "space-class"]`   |
| Parking    | `["l", "parking-spot", "space-class"]` |
| Storage    | `["l", "storage-unit", "space-class"]` |
| Camping    | `["l", "campsite", "space-class"]`     |
| Marinas    | `["l", "boat-slip", "space-class"]`    |
| Co-working | `["l", "desk", "space-class"]`         |

---

## 9. Industry-Specific Extensions

Implementations MAY add industry-specific tags. These SHOULD be documented and use consistent naming.

### 9.1. RV Parks / Campgrounds

| Tag                  | Description             | Example                                        |
| -------------------- | ----------------------- | ---------------------------------------------- |
| `slide_outs_allowed` | Slide-out policy        | `["slide_outs_allowed", "both-sides"]`         |
| `hookups`            | Utility connections     | `["hookups", "50-amp", "water", "sewer"]`      |
| `equipment_policy`   | Allowed equipment types | `["equipment_policy", "allowed", "motorhome"]` |

### 9.2. Parking

| Tag            | Description           | Example                                                   |
| -------------- | --------------------- | --------------------------------------------------------- |
| `vehicle_type` | Allowed vehicle types | `["vehicle_type", "car"], ["vehicle_type", "motorcycle"]` |
| `covered`      | Is the spot covered   | `["covered", "true"]`                                     |
| `ev_charging`  | EV charging available | `["ev_charging", "level-2"]`                              |

### 9.3. Storage Units

| Tag                  | Description               | Example                          |
| -------------------- | ------------------------- | -------------------------------- |
| `climate_controlled` | Temperature controlled    | `["climate_controlled", "true"]` |
| `access_hours`       | When unit can be accessed | `["access_hours", "24/7"]`       |
| `drive_up`           | Drive-up access           | `["drive_up", "true"]`           |

---

## 10. Reference Implementations

- [RV Parker](https://github.com/westernbtc/rv-parker) - RV park booking system

---

## 11. Appendix: Kind Registry

| Kind    | Name                  | Type                 |
| ------- | --------------------- | -------------------- |
| `33000` | Physical Location     | Addressable (NIP-41) |
| `33001` | Space Class           | Addressable          |
| `33002` | Space                 | Addressable          |
| `33003` | Availability Snapshot | Addressable          |
| `33012` | Pricing Configuration | Addressable          |
| `33013` | Rental Policy         | Addressable          |
| `31922` | Reservation           | Addressable (NIP-52) |
