NIP-63
======

Testimonials
------------

`draft` `optional`

This NIP defines a protocol for sending and displaying testimonials (also known as "testimonies") between users, inspired by the classic social network feature. Testimonials allow users to write public endorsements or kind words about other users that can be displayed on their profiles.

## Overview

The testimonial flow works as follows:

1. **Sender** creates a testimonial and gift-wraps it to the recipient using [NIP-59](59.md)
2. **Recipient** receives and decrypts the wrapped testimonial
3. **Recipient** decides to either accept (publish) or reject (delete) the testimonial
4. If accepted, the **recipient** publishes the `kind:63` event and adds it to their public testimonials list

This design gives recipients full control over which testimonials appear on their profile, preventing unwanted or inappropriate content from being publicly associated with them.

## Testimonial Event (kind 63)

A testimonial is a `kind:63` event containing the testimonial message. Unlike typical gift-wrapped events, testimonials are **signed** to ensure authenticity - recipients and viewers can cryptographically verify who wrote each testimonial.

```jsonc
{
  "kind": 63,
  "pubkey": "<sender-pubkey>",
  "created_at": "<timestamp>",
  "tags": [
    ["p", "<recipient-pubkey>"]
  ],
  "content": "You've always been such an inspiring person to me! Your contributions to the community have made a real difference.",
  "id": "<event-id>",
  "sig": "<sender-signature>"
}
```

The `content` field contains the testimonial text in plain text. Clients MAY support basic formatting.

The `p` tag MUST contain the recipient's public key.

The event MUST be signed by the author. This signature allows anyone to verify the testimonial's authenticity later.

## Sending a Testimonial

To send a testimonial privately, use a modified [NIP-59](59.md) gift wrap protocol:

1. Create and **sign** the `kind:63` testimonial event
2. Encrypt the signed event using [NIP-44](44.md) to the recipient's pubkey
3. Wrap it in a `kind:1059` gift wrap, addressed to the recipient

Note: Unlike standard NIP-59 which uses unsigned rumors for deniability, testimonials use signed events because authenticity is essential - users must be able to verify who wrote each testimonial.

```jsonc
// Gift Wrap (kind 1059)
{
  "id": "<id>",
  "pubkey": "<random-one-time-pubkey>",
  "created_at": "<random-timestamp>",
  "kind": 1059,
  "tags": [
    ["p", "<recipient-pubkey>"]
  ],
  "content": "<nip44-encrypted-kind-63-event>",
  "sig": "<signature-from-random-key>"
}
```

Clients SHOULD send testimonial gift wraps to relays listed in the recipient's `kind:10050` DM relay list, falling back to the recipient's regular relays if not available.

## Receiving a Testimonial

When a client receives a `kind:1059` gift wrap containing a testimonial:

1. Decrypt the gift wrap content using the recipient's private key
2. Parse the decrypted JSON as a `kind:63` event
3. **Verify the signature** matches the pubkey and content (this proves authenticity)
4. Verify the `p` tag contains the recipient's pubkey
5. Present the testimonial to the user for approval

Clients MUST reject testimonials with invalid signatures.

## Testimonials List (kind 10064)

Users store their accepted testimonials in a `kind:10064` replaceable event. This list references published `kind:63` events.

```jsonc
{
  "kind": 10064,
  "pubkey": "<user-pubkey>",
  "created_at": "<timestamp>",
  "tags": [
    ["e", "<kind-63-event-id>", "<relay-hint>"],
    ["e", "<kind-63-event-id>", "<relay-hint>"]
  ],
  "content": "",
  "sig": "<signature>"
}
```

Each `e` tag references a published `kind:63` testimonial event.

This design:
- Avoids data duplication - testimonial content lives in the `kind:63` event
- **Signatures are already in the `kind:63`** - verification is straightforward
- Follows standard Nostr patterns for referencing events
- Gives the profile owner full control over which testimonials are listed

### Publishing a Testimonial

When a user accepts a testimonial:

1. **Publish the `kind:63` event** to the testimonial author's write relays (it's already signed by the author)
2. Add an `e` tag referencing the `kind:63` event ID to their `kind:10064` list
3. Publish the updated `kind:10064` event

Clients SHOULD append new `e` tags to the end of the tags array to maintain chronological order.

### Displaying Testimonials

To display a user's testimonials:

1. Fetch the user's `kind:10064` event
2. For each `e` tag, fetch the referenced `kind:63` event
3. Verify each `kind:63` event's signature
4. Display verified testimonials with author info

### Removing a Testimonial

**By recipient:**
1. Remove the corresponding `e` tag from the tags array
2. Publish the updated `kind:10064` event

**By author:**
1. Send a `kind:5` deletion request for the `kind:63` event (author holds the signing key)

Clients SHOULD check for `kind:5` deletion requests when displaying testimonials and hide deleted ones.

## Client Behavior

### Sending Clients

- SHOULD provide a character limit guidance (recommended: 280-500 characters)
- SHOULD warn users that testimonials require recipient approval
- MAY allow users to see their pending/sent testimonials

### Receiving Clients

- MUST present incoming testimonials for user approval before publishing
- SHOULD allow users to preview how the testimonial will appear
- SHOULD provide easy accept/reject actions
- MAY implement notification for new testimonial requests

### Profile Display Clients

- MUST fetch referenced `kind:63` events from relays
- MUST verify `kind:63` signatures before displaying
- SHOULD display accepted testimonials on user profiles
- SHOULD fetch and display author profile information (name, picture)
- SHOULD hide testimonials that fail signature verification
- MAY paginate testimonials if there are many
- MAY allow sorting by date or author

## Privacy and Security Considerations

- Testimonial requests are encrypted during transit using gift wrap, protecting users from unwanted public associations until they choose to accept
- Once accepted, testimonials are publicly visible in the `kind:10064` list
- **Signatures prevent forgery** - no one can create a fake testimonial claiming to be from someone else
- Users have complete control over their testimonials list and can add or remove testimonials at any time
- Rejected testimonials can be deleted without any public trace
- Testimonial authors CAN retract testimonials by sending a `kind:5` deletion request (since they hold the signing key). This is intentional - authors have the right to change their mind
- Unlike NIP-17 DMs, testimonials are **not deniable** - the signature proves authorship. This is intentional: testimonials are meant to be attributable endorsements

## Example Flow

### 1. Alice writes a testimonial for Bob

Alice creates and **signs** the testimonial:
```jsonc
{
  "kind": 63,
  "pubkey": "alice-pubkey",
  "created_at": 1704067200,
  "tags": [["p", "bob-pubkey"]],
  "content": "Bob helped me understand Nostr when I was just getting started. Forever grateful!",
  "id": "abc123...",
  "sig": "alice-signature-abc..."
}
```

Alice encrypts it with NIP-44, wraps it in a `kind:1059` gift wrap, and sends to Bob's relays.

### 2. Bob receives and accepts the testimonial

Bob's client decrypts the gift wrap, **verifies Alice's signature**, shows the testimonial, and Bob clicks "Accept".

Bob's client:
1. Publishes the `kind:63` event (already signed by Alice) to Alice's write relays
2. Updates his `kind:10064`:
```jsonc
{
  "kind": 10064,
  "pubkey": "bob-pubkey",
  "created_at": 1704067300,
  "tags": [
    ["e", "abc123...", "wss://relay.example.com"]
  ],
  "content": "",
  "sig": "bob-signature..."
}
```

### 3. Carol views Bob's profile

Carol's client fetches Bob's `kind:10064`, fetches each referenced `kind:63` event, verifies signatures, and displays:

> **Testimonials**
>
> _"Bob helped me understand Nostr when I was just getting started. Forever grateful!"_
> â€” Alice (@alice), Jan 1, 2024

## Appendix: Kind Summary

| Kind  | Description          | NIP                |
| ----- | -------------------- | ------------------ |
| 63    | Testimonial (signed) | This NIP           |
| 1059  | Gift Wrap            | [59](59.md)        |
| 10064 | Testimonials List    | This NIP           |
