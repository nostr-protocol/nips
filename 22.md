NIP-22
======

Comment
-------

`draft` `optional`

A comment is meant to be used to comment on
or reply to anything except event kinds
whose specifications have already defined other
ways to comment on or reply to them.

For example, it can be used to comment on a [NIP-23](23.md) `kind:30023` nostr blog post
or on an off-nostr news article or to reply to another comment.

## Structure

A comment is an event of `kind:1111` with plaintext `.content`
(no HTML, no Markdown nor other formatting).

**It must have a `k` tag** pointing to the kind of the subject being commented on.
Its value has no prefix for nostr subjects but does have prefixes (listed in a section ahead)
for things that aren't nostr events.

For example, when commenting on a `kind:30023`, the `k` tag is set to "30023".
When replying to another `kind:1111`, the `k` tag is set to "1111".

The `k` tag is useful to fetch top-level comments about events of specific types, for example,
by filtering with `{ "#k": ["30023"], "kinds": [1111] }`.

**An uppercase `K` tag must also be present.** The difference is that it is set to the original post (the one starting the thread) kind.
This way a client can request all comments related to the kind it supports, not only the top-level comments.

### Threads

**There is always an `E` or `A` or `R` tag** pointing to the original post that started the thread.
`E` value is an event id, for `A` an event address and for `R` others values shown at below section.
These tags are useful to load all messages of a thread at once.

Note that if commenting on a replaceable event, one can choose to add both `E` and `A` references.

After the first value, there maybe be a relay hint followed by a [NIP-65](65.md) pubkey hint
or just a website hint for external references.

Examples:

- `["E", "<event-id>", "<relay-url, optional>", "<event-pubkey, optional>"]`
- `["A", "<event-kind>:<event-pubkey>:<d-tag, optional>", "<relay-url, optional>"]`
- `["R", "i:<nip-73-kind>", "<website-url, optional>"]`

Also, **there is always an `e`, `a` or `r` tag** pointing to the subject being directly commented on or replied to, using the
same structure of the uppercase versions.
These tags are useful to lazily load a thread.

### Possible `R`/`r` tag values and their corresponding `K/k` tag values

| `R`/`r` tag | corresponding `K/k` tag |
| - | - |
| "r:`<url>`" | "r:`<domain>`" |
| "i:`<nip-73-id>`" | "i:`<nip-73-kind>`" |
| "t:`<topic>`" | "#:t" |
| "g:`<geohash>`" | "#:g" |

#### Thread Relays

If the original post being commented on is a nostr event and
the client supports the [NIP-65](65.md) relay usage spec,
`kind:1111` events should be sent atleast to the original post author's `read` relays.

### Event Examples

```js
{
  kind: 1111,
  content: 'Agree with your comment.',
  tags: [
    // referencing the OP
    ["R", "r:https://abc.com/articles/1"],
    // replying to a parent kind:1111 comment
    ["e", "5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36", "wss://example.relay", "f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca"],
    // the OP "kind"; for an url, the kind is its domain
    ["K", "r:https://abc.com"]
    // the parent kind
    ["k", "1111"]
  ]
  // other fields
}
```

```js
{
  kind: 1111,
  content: 'Great blog post! Check this out nostr:npub1sn0wdenkukak0d9dfczzeacvhkrgz92ak56egt7vdgzn8pv2wfqqhrjdv9.',
  tags: [
    // top-level comments have the same OP and parent references
    ["A", "30023:3c9849383bdea883b0bd16fece1ed36d37e37cdde3ce43b17ea4e9192ec11289:f9347ca7", "wss://example.relay"],
    ["a", "30023:3c9849383bdea883b0bd16fece1ed36d37e37cdde3ce43b17ea4e9192ec11289:f9347ca7", "wss://example.relay"],
    // the OP kind
    ["K", "30023"]
    // the parent kind
    ["k", "30023"],
    // the nostr:npub1... mentioned on .content
    ["p", "84dee6e676e5bb67b4ad4e042cf70cbd8681155db535942fcc6a0533858a7240"]
  ]
  // other fields
}
```

Note that ideally there are no `p` tags unless the pubkey is being mentioned on the `.content`.

### Examples for Commenting on NIP-73 External Content

A podcast comment example:

```js
{
  id: "80c48d992a38f9c445b943a9c9f1010b396676013443765750431a9004bdac05",
  pubkey: "f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca",
  kind: 1111,
  content: "This was a great episode!",
  tags: [
    [
      "R",
      "i:podcast:item:guid:d98d189b-dc7b-45b1-8720-d4b98690f31f",
      // website url hint
      "https://fountain.fm/episode/z1y9TMQRuqXl2awyrQxg"
    ],
    // same value as "R" tag above, because it is a top-level comment (not a reply to a comment)
    [
      "r",
      "i:podcast:item:guid:d98d189b-dc7b-45b1-8720-d4b98690f31f",
      "https://fountain.fm/episode/z1y9TMQRuqXl2awyrQxg"
    ],

    ["K", "i:podcast:item:guid"], // uppercase K, this is the OP (original post)'s kind, that is, a podcast item
    ["k", "i:podcast:item:guid"] // lowercase k; in the case of a top-level comment, it is the same as the uppercase K
  ],
  created_at: 1723748973
}
```

A reply to a podcast comment example:

```js
{
  kind: 1111,
  content: "I'm replying to the above comment.",
  tags: [
    [
      "R",
      "i:podcast:item:guid:d98d189b-dc7b-45b1-8720-d4b98690f31f",
      "https://fountain.fm/episode/z1y9TMQRuqXl2awyrQxg"
    ],
    // the "r" tag is a reference to the above comment
    [
      "e",
      // <id-of-the-above-comment>
      "80c48d992a38f9c445b943a9c9f1010b396676013443765750431a9004bdac05",
      // <url-of-the-relay-where-above-comment-was-fetched-from>
      "wss://example.relay"
      // <pubkey-of-the-above-comment-author>
      "f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca",
    ],

    ["K", "i:podcast:item:guid"], // uppercase K, this is the OP (original post)'s kind, that is, a podcast item
    ["k", "1111"] // lowercase k; this is the above comment's kind
  ]
  // other fields
}
```

Note that for podcast items, the K or k tag is `i:podcast:item:guid`,
for books it is `i:isbn` while for movies it is `i:isan`.
