NIP-77
======

Trust Clock
-----------

`draft` `optional` `author:arthurfranca` `author:melvincarvalho`

## What the Trust Clock Does?

It creates an event's `created_at` proof scoped to a client.
For more clients to trust the event's `created_at`, more `clock` tags
scoped to different clients are used.

## How to Use the Trust Clock?

A client first picks three relays to trust as a clock for a period
such as a month window. The client should keep
a log of all the trusted relay sets for each time window.

One way of selecting trusted relays is as follows:
a client collects relay hints from some of the events
its users fetch, excluding encrypted ones. Relays hints are
relay urls present in `e`, `p`, `a` or `relay` tags.
The 3 most trusted relays by the client user base
(relays that support this NIP) would be the 3 relay urls with more
relay hints in a month window.

The client trusted relay list at the time in milliseconds,
informed on the `at` query param, can be checked at
"https://client.example/.well-known/nostr/nip77.json?get=relays&at=\<time-in-ms\>":
`{ relays: ["https://relay1.example", "https://relay2.example", "https://relay3.example"] }`.

Clients can delegate trust by responding to
"https://client.example/.well-known/nostr/nip77.json?get=relays&at=\<time-in-ms\>"
with: `{ delegated_to: "https://another.client" }`

Now it is possible to ask what time is it in milliseconds at
"https://relay1.example/.well-known/nostr/nip77.json?get=now"
and at the other two relay routes.

The response is a JSON `{ now: ["<relay1pubkey>", "<time-in-ms>", "<signature>"] }`.
The signature uses the same Schnorr setup from NIP-01 but the considered "id" is just the
"\<time-in-ms\>" string.

There is also "https://relay1.example/.well-known/nostr/nip77.json?get=pubkey&at=\<time-in-ms\>"
to check what was the canonical relay pubkey at the time: `{ pubkey: "<pubkey-at-that-time>" }`.
That's why a relay should keep a log of all the pubkeys used for each time window.

An user can use the response to prove its event's `created_at` is near the
Trust Clock time, using atleat 2 `now` tags from the same set of relays a client trusts:

```
["clock", "https://client.example", "https://relay1.example", "<time-in-ms>", "<signature>"],
["clock", "https://client.example", "https://relay3.example", "<time-in-ms>", "<signature>"]
```

### Validation

The time used in `clock` tags shouldn't diverge more than 30 seconds.

The signature can be validated with the pubkey from
"https://relay1.example/.well-known/nostr/nip77.json?get=pubkey&at=\<time-in-ms\>".

The client trusted relay list at the time can be checked at
"https://client.example/.well-known/nostr/nip77.json?get=relays&at=\<time-in-ms\>".
