NIP-45
======

Event Counts
--------------

`draft` `optional` `author:staab`

Relays may support the verb `COUNT`, which provides a mechanism for obtaining event counts.

## Motivation

A client may want to execute certain queries against connected relays, but some of these may be excessively resource-intensive. For instance, retrieving follower counts for a specific public key requires the client to query all kind-3 events associated with that public key, just for the purpose of counting them. Although it's possible to cache the result, whether by the client itself or a separate indexing server, these options tend to undermine the network's decentralization. They essentially create a secondary protocol layered on top of Nostr, which could potentially disrupt its original structure and function.

## Filters and return values

This NIP defines the verb `COUNT`, which accepts a subscription id and filters as specified in [NIP 01](01.md) for the verb `REQ`. Multiple filters are OR'd together and aggregated into a single count result.

```
["COUNT", <subscription_id>, <filters JSON>...]
```

Counts are returned using a `COUNT` response in the form `{"count": <integer>}`. Relays may use probabilistic counts to reduce compute requirements.

```
["COUNT", <subscription_id>, {"count": <integer>}]
```

Examples:

```
# Followers count
["COUNT", <subscription_id>, {"kinds": [3], "#p": [<pubkey>]}]
["COUNT", <subscription_id>, {"count": 238}]

# Count posts and reactions
["COUNT", <subscription_id>, {"kinds": [1, 7], "authors": [<pubkey>]}]
["COUNT", <subscription_id>, {"count": 5}]
```
