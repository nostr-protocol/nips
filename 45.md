NIP-45
======

Event Counts
--------------

`draft` `optional` `author:staab`

Relays may support the `COUNT` verb, which provide a mechanism for obtaining event counts.

## Motivation

Some queries a client may want to execute against connected relays are prohibitively expensive, for example, in order to retrieve follower counts for a given pubkey, a client must query all kind-3 events referring to a given pubkey and count them.

## Filters and return values

This NIP defines a verb called `COUNT`, which accepts a subscription id and one or more filters as specified in [NIP 01](01.md).

Counts are returned using a `COUNT` response in the form `{count: <integer>}`. If multiple filters were specified in the request, the same number of results MUST be returned. Relays may use probabilistic counts to reduce compute requirements.

Relays MAY support an additional `group_by` parameter which specifies a list of event properties to group by. Results will be returned as a list of counts for each group with the `group_by` parameter included.

Some counts may be burdensome for relays to fulfill, relays MAY impose a limit on number of groups returned, and SHOULD raise a NOTICE if a request cannot be fulfilled.

Examples:

```json
// Followers count
["COUNT", "subid", {"kinds": [3], "#p": [<pubkey>]}]
["COUNT", "subid", {"count": 238}]

// Count posts and reactions
["COUNT", "subid", {"kinds": [1, 7], "authors": [<pubkey>]}]
["COUNT", "subid", {"count": 5}]

// Count posts by author
["COUNT", "subid", {"kinds": [1]}, {"kinds": [1], "group_by": ["pubkey"]}]
["COUNT", "subid", {"count": 32}, [{"count": 3, "pubkey": <pubkey1>}, {"count": 29, "pubkey": <pubkey2>}]]
```
