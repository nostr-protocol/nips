# NIP-41

## Places (geohash ladder addressable locations)

`draft` `optional`

Clients need a simple, relay-indexable way to discover physical places (e.g., RV parks, cafés, venues) and to query them efficiently on maps. It should work with relays that don't have "Search Capability" (NIP-50). This NIP defines a parameterized replaceable event for “Places” that are **geohash-addressable** via a ladder of `g` tags—from coarse to fine precision—so clients can query by exact `#g` matches without prefix search.

## 2. Event Kind

- **Kind:** `33000`
- **Type:** Addressable (NIP-01)
- **Parameterized key:** the first `["d", <identifier>]` tag (e.g., a random ID)

## 3. Required/Recommended Fields

### 3.1. Required fields/tags

- `["d", "<stable-id>"]` — a random ID (e.g., `permit:FL:44-54-00003`, `slug:lochloosa-harbor`, etc.)
- At least one `["g", "<geohash>"]` tag.  
  The **recommended pattern** is to include a **ladder** of geohash prefixes from coarse to fine precision (e.g., `d`, `dj`, `dj3`, `dj3p`, …). **Recommended precision is at least 7**. This enables fast map queries with `#g` matching at various zoom levels.

### 3.2. Recommended tags

- `["name", "<display name>"]`
- `["website", "<website url>"]` — official website or listing
- `["image", "<absolute url>"]` — can have multiple -- where first image is the cover
- `["phone", "<E.164 or human>"]`
- `["email", "<standard email address>"]`
- `["booking_url", "<specific url for booking>"]`
- `["measurement_system", "<imperial | metric>"]`
- `["primary_currency", "<currency code>"]` - currency code like USD
- `["payment_method", "<currency code>", "<type>"]` - e.g.: ["payment_method", "USD", "cash"]
- `["address", "<street>", "<city>", "<region>", "<postal>", "<country>"]`
- `["hours", "<day of week abbrevation>", "<shift one>", "<shift two>", ...]` - e.g., ["hours","thu","09:00/12:30","13:30/17:00"]
- `["L", "physical-location"]`
- `["l", "<physical-location-type>", "physical-location"]` - freeform type labels used to reduce results for usecase (e.g., `business`, `rv-park`, `restaurant`, etc.)
- `["t", "<further specifics to filter by>"]` - further filter results e.g., `["t", "accepts-bitcoin"], ["t", "washer-dryer"]`

### 3.3. Optional tags

- Non-indexed attributes specific to the physical location type:
  - `["meta", "<key>", "<value"]` - e.g., `["meta", "rv-space-capacity", "69"]`

### 3.4. Content

- `content` is a plain text short readable description.

---

## 4. Geohash (`g`) Tag Rules

- A `g` tag value is a standard **Base32 geohash** (lowercase), length 1–12.
- Include **multiple** `g` tags forming a **coarse → fine ladder** for the same point, e.g.:

  ```
  ["g","d"]
  ["g","dj"]
  ["g","dj3"]
  ["g","dj3p"]
  ["g","dj3pz"]
  ["g","dj3pzs"]
  ["g","dj3pzsu"]
  ["g","dj3pzsuc"]
  ```

- Reason: relays and clients can match `#g` **exactly** at any zoom level. The Place then appears in map queries that request any of those zoom-appropriate buckets.

> Publishers **should** generate the ladder from a single point (lat/lon → geohash) and decide the deepest precision they care to expose (e.g., 7–8 chars for point-of-interest).

---

## 5. Querying

### 5.1. Relay filters

- Fetch all Places within a geohash bucket:

  ```json
  {
    "kinds": [33000],
    "#g": [
      "dhvj",
      "dhvm",
      "dhvn",
      "dhvp",
      "dhvq",
      "dhvr",
      "dhvt",
      "dhvw",
      "dhvx",
      "djj0",
      "djj2",
      "djj8"
    ],
    "#l": ["rv-park"],
    "#t": ["accepts-bitcoin"]
  }
  ```

- Zoom out: use shorter prefixes already present as `#g` values (e.g., `["dhv"]`).

- Fetch/refresh a specific place (parameterized key):

  ```json
  {
    "kinds": [33000],
    "authors": ["<pubkey>"],
    "#d": ["<string / uuid>"]
  }
  ```

---

## 6. Example (valid per this NIP)

```json
{
  "kind": 33000,
  "pubkey": "0e29efc2a3eb6966403e8c61cb8bea6d78527af5e0565a2baa0f313eff142af2",
  "created_at": 1766059634,
  "tags": [
    ["L", "physical-location"],
    ["l", "business", "physical-location"],
    ["l", "rv-park", "physical-location"],
    ["name", "Floating RV Park"],
    ["d", "39d8fb01-0ab9-47c8-96bc-f350dcbb7b77"],
    ["primary_currency", "USD"],
    ["measurement_system", "imperial"],
    ["website", "https://westernbtc.com"],
    [
      "booking_url",
      "https://rvparker.westernbtc.com/book/parks/naddr1qvzqqqyqaqpzqr3falp286mfveqrarrpew975mtc2fa0tczktg465re38ml3g2hjqyd8wumn8ghj7un9d3shjtnhv4ehgetjde38gcewvdhk6qg5waehxw309aex2mrp0yhxgctdw4eju6t0qyt8wumn8ghj7un9d3shjtnswf5k6ctv9ehx2aqpp4mhxue69uhkummn9ekx7mqqysenjepcve3rqvfdxpskywfdxsmkxwpd8ymxycedvcen2vryvd3xydmzxumsqvst7f"
    ],
    ["address", "21000 BTC Ln", "Tampa", "FL", "33602", "USA"],
    ["t", "wifi"],
    ["t", "washer-dryer"],
    ["t", "gym"],
    ["t", "full-hookups"],
    ["t", "water-front"],
    ["t", "pool"],
    ["t", "accepts-bitcoin"],
    ["hours", "mon", "08:00/17:00"],
    ["hours", "tue", "08:00/17:00"],
    ["hours", "wed", "08:00/17:00"],
    ["hours", "thu", "08:00/17:00"],
    ["hours", "fri", "08:00/17:00"],
    ["hours", "sat", "08:00/14:00"],
    ["hours", "sun"],
    ["g", "d"],
    ["g", "dh"],
    ["g", "dhv"],
    ["g", "dhvn"],
    ["g", "dhvnz"],
    ["g", "dhvnzw"],
    ["g", "dhvnzwq"],
    [
      "image",
      "https://blossom.westernbtc.com/15e5b8c56a347859fa293b80c4e949ae168407da364ca11b36854e2f46906402.webp"
    ],
    [
      "image",
      "https://blossom.westernbtc.com/2d9ec90fc5f1fcdd0ba4119d63b48fddd7f71b003eeb36877a810c8d416ddb2d.webp"
    ],
    [
      "image",
      "https://blossom.westernbtc.com/4acd5cb944f5ef94ea49e1a3d5a73fd5eb47dcfa96ca76530b7bdac1c8ed485e.webp"
    ],
    ["payment_method", "USD", "credit_card"],
    ["payment_method", "USD", "cash"],
    ["payment_method", "BTC", "onchain"],
    ["payment_method", "BTC", "lightning"]
  ],
  "content": "The worlds first (and probably last) floating RV park!",
  "id": "4efb43978b62b02b228b39fc9dbaa8cbed8ce787144601f362da011c32ae6ec7",
  "sig": "ef176c438d72ad905e97fe4392662b5f7cf328f134d697e01d8ddbd1e6c6250926a90ef362c9437cdadf786802c3e18bed9386ac483f501b48beecdb6b6596fe"
}
```

---

## 7. Client Guidance

- Clients may choose to `limit` returned events at a more coarse precision.
- For map tiles/zoom levels, choose the geohash precision to query:
  - World/continent: 1–2 chars
  - Region/state: 3–4
  - Metro/city: 5–6
  - Neighborhood/POI: 7–9
- Query one or more `#g` values covering the viewport. (For polygons, derive covering geohash buckets and query all of them.)

---

## 8. Examples

- https://rvparker.westernbtc.com

## 9. Validation Rules and Privacy

- Must have at least one `["d", ...]` and one `["g", ...]`.
- `["g", ...]` must be valid Base32 geohash, lowercase, no `a,i,l,o`.
- Publishing precise geohashes reveals location; authors may choose a coarser precision if needed.
