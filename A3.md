# NIP-A3

## payto: Payment Targets (RFC-8905)

### Event Kind

This NIP defines `kind:10133` for payment target events. This kind is **replaceable**.

`optional` `author:atxmj`

This NIP standardizes the approach to payment and tip invocations from user profiles, posts, chats, and elsewhere using the [RFC-8905 (payto:) URI scheme](https://www.rfc-editor.org/rfc/rfc8905.html) standard for "payment targets".

This approach follows the precedent established by other NIPs that provide standardization on generalized abstractions rather than individual proprietary protocols:

- [NIP-21](21.md) standardizes a generalized `nostr:` URI scheme for different entity types rather than separate schemes for each type
- [NIP-19](19.md) provides generalized bech32 encoding for different Nostr entities rather than separate encodings
- [NIP-39](39.md) creates a unified framework for external identity verification across different platforms rather than platform-specific approaches
- [NIP-89](89.md) generalizes application handler discovery for different event kinds rather than kind-specific handling

Similar to these, NIP-A3 provides a standardized payment target framework rather than relying on individual proprietary protocols like NIP-57's Lightning-specific approach.

### payto: event broadcasting

Clients *may* allow users to specify a list (one or many) of "payment targets" as specified in the [RFC-8905 (payto:) URI scheme](https://www.rfc-editor.org/rfc/rfc8905.html) standard, each consisting of a pair of values, `type` and `authority` (to be labeled as preferred by the client), in order to generate an event of kind `10133` (`payto`) with `payto` tags specifying "payment targets" that *may* be used for payment or tip invocation from a user's profile, posts, chats, or elsewhere.

The client *may* allow the user to input and perform validation on the `type` and `authority` fields (labeled as preferred by the client) as they see fit.

#### Tag Format

Payment targets are specified using `payto` tags with the following structure:

```text
["payto", "<type>", "<authority>", "<optional_extra_1>", "<optional_extra_2>", ...]
```

Where:
- The first element is always the literal string `"payto"`
- The second element is the payment `type` (e.g., `"bitcoin"`, `"lightning"`)
- The third element is the `authority` (e.g., address, username)
- Additional elements are optional and reserved for future RFC-8905 features

Clients **must** understand elements 0–2; they **may ignore** any additional elements for forward compatibility.

#### Validation Guidelines

Following RFC-8905 guidelines, clients should validate payto entries as follows:

- `type`: Should consist of lowercase letters (a-z), digits (0-9), and hyphens (-). No spaces or special characters allowed. Types are case-insensitive - clients should normalize input to lowercase before storage and comparison.
- `authority`: Should be URL-safe. If the authority contains special characters, it should be properly URL-encoded. The format depends on the specific payment system.
- Clients may perform additional payment-system-specific validation for recognized types (e.g., checksum validation for cryptocurrency addresses).

### Example of broadcasting a "payto" event

The client allows the user to add multiple pairs of `type` and `authority` values to a list of "payment options" in their profile.

The client performs validation on the inputs and warns the user that the `type` for the third "payment option" with value `unknowntype` is [not recognized](#recommended-payment-target-types), but allows them to submit it regardless.

The client then broadcasts an event such as

```json
{
  "pubkey": "afc93622eb4d79c0fb75e56e0c14553f7214b0a466abeba14cb38968c6755e6a",
  "kind": 10133,
  "content": "",
  "tags": [
    ["payto", "bitcoin", "bc1qxq66e0t8d7ugdecwnmv58e90tpry23nc84pg9k"],
    ["payto", "nano", "nano_1dctqbmqxfppo9pswbm6kg9d4s4mbraqn8i4m7ob9gnzz91aurmuho48jx3c"],
    ["payto", "unknowntype", "l7tbta5b9xze6ckkfc99uohzxd009b0r"]
  ],
  ...
}
```

#### Example of steps taken by the client on input

- allow the user to specify a list of `type` and `authority` value pairs (labeled as preferred by the client) of their choice
- for each pair of `type` and `authority` values specified by the user
    - *optionally* do some minimal validation on those fields in a generalized way that applies to any payment type
    - *optionally* warn users if a specified `type` is not [*recognized*](#recommended-payment-target-types) by the client
- broadcast the event in the format specified above

### Recommended Payment Target Types

This is a list of recommended payment target types for clients to recognize and store icons and stylization configurations for.

> Note: In the future, a proper "payment target type registry" could be added via a separate NIP, or referenced from a separate source.

| Payment Target Type | Long Stylization  | Short Stylization | Symbol | References |
| :------------------ | :---------------- | :---------------- | :----- | :--------- |
| bitcoin             | Bitcoin           | BTC               | ₿      | https://bitcoin.design/ |
| cashme              | Cash App          | Cash App          | $,£    | https://cash.app/press |
| ethereum            | Ethereum          | ETH               | Ξ      | https://ethereum.org/assets/#brand |
| lightning           | Lightning Network | LBTC              | 丰     | https://github.com/shocknet/bitcoin-lightning-logo |
| monero              | Monero            | XMR               | ɱ      | https://www.getmonero.org/press-kit/ |
| nano                | Nano              | XNO               | Ӿ      | https://nano.org/en/currency |
| revolut             | Revolut           | Revolut           | N/A    | https://revolut.me |
| venmo               | Venmo             | Venmo             | $      | https://venmo.com/pay |

### payto: event observation

On observation of events of kind `10133` (`payto`), the event *may* include `payto` tags, each specifying a "payment target" with values `type` and `authority` as specified in the [RFC-8905 (payto:) URI scheme](https://www.rfc-editor.org/rfc/rfc8905.html) for payment targets.

For each `payto` tag where the first element is `"payto"`, the second element is the `type`, and the third element is the `authority`, the client *should* assemble a full `payto://` deep link URI and render it as a button or link in the user's profile, posts, chats, or elsewhere, in the format of `payto://<type>/<authority>`. 

The client *should* store a map of [recognized payment target types](#recommended-payment-target-types) along with a corresponding icon & stylization configuration (to be defined by the client).

For ***recognized*** `type` values, the client *should* render a button or link using the associated icon & stylization. 

For ***unrecognized*** `type` values, the client *may* choose to either ignore them or use a generic stylization, perhaps using the `type` value directly for the button or link.

If a user has specified multiple payment targets, the client *may* choose to render only the first one, render multiple buttons or links, or render a dropdown to select the payment target of choice.

### Example of observing a "payto" event

If a client sees an event like this:

```json
{
  "pubkey": "afc93622eb4d79c0fb75e56e0c14553f7214b0a466abeba14cb38968c6755e6a",
  "kind": 10133,
  "content": "",
  "tags": [
    ["payto", "bitcoin", "bc1qxq66e0t8d7ugdecwnmv58e90tpry23nc84pg9k"],
    ["payto", "nano", "nano_1dctqbmqxfppo9pswbm6kg9d4s4mbraqn8i4m7ob9gnzz91aurmuho48jx3c"],
    ["payto", "unknowntype", "l7tbta5b9xze6ckkfc99uohzxd009b0r"]
  ],
  ...
}
```

for each payment target it will assemble a deep link payment invocation URI, as

`payto://bitcoin/bc1qxq66e0t8d7ugdecwnmv58e90tpry23nc84pg9k` (*recognized*)
`payto://nano/nano_1dctqbmqxfppo9pswbm6kg9d4s4mbraqn8i4m7ob9gnzz91aurmuho48jx3c` (*recognized*)
`payto://unknowntype/l7tbta5b9xze6ckkfc99uohzxd009b0r` (*unrecognized*)

The client chooses to ignore the third *unrecognized* `type`, and only embeds the first two payment target deep links in the user's profile, posts, chats, or elsewhere as buttons, links, or a dropdown selector using the corresponding icons & stylizations for the [*recognized* payment target types](#recommended-payment-target-types).

*Optionally*, the client may have chosen to render the third payment target using the text `unknowntype` rather than ignoring it.

#### Example of steps taken by the client on observation

- for each `payto` tag in the event (where the first element equals `"payto"`)
    - *optionally* do some minimal validation on the `type` (second element) and `authority` (third element) fields in a generalized way that applies to any payment type, and filter out invalid tags
    - *optionally* filter out any tags with an [*unrecognized*](#recommended-payment-target-types) `type`
    - assemble a full `payto://` deep link URI in the format `payto://<type>/<authority>`
    - render a button, link, or dropdown in user profiles, posts, chats, and elsewhere using the assembled deep links and the corresponding icons & stylization configurations for *recognized* `type` values

## Implementation Notes

### Integration with NIP-57 Zaps

Clients implementing both NIP-A3 and NIP-57 may choose to use `payto` lightning entries as an alternative or complement to the `lud16` field for zap functionality:

- When zapping a user, clients can check for `payto` tags with `type: "lightning"` in their kind 10133 payto events
- These can be used alongside or instead of `lud16` fields for Lightning Network payments
- The `authority` field for lightning entries should contain a Lightning address (e.g., `user@wallet.example.com`) or a direct LNURL
- Clients should prioritize user preferences but may fall back between `lud16`, `payto` lightning entries, and `zap` tags on events

Example of a profile supporting both approaches:

```json
[
  {
    "kind": 0,
    "content": "{\"lud16\":\"user@wallet.example.com\"}",
    "pubkey": "..."
  },
  {
    "kind": 10133,
    "content": "",
    "tags": [
      ["payto", "lightning", "user@wallet.example.com"],
      ["payto", "bitcoin", "bc1q..."]
    ],
    "pubkey": "..."
  }
]
```

This provides redundancy and allows users to specify multiple payment methods while maintaining compatibility with existing zap implementations.