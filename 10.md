NIP-10
======

Replies, Reposts, and Quote Posts in Text Events (kind 1).
--------------------------------------------

`draft` `optional` `author:unclebobmartin` `author:alexgleason` `author:Semisol` `author:arthurfranca`

## Abstract
This NIP describes how to use "n" and "l" tags in text events to denote replies. Also "e" tags for reposts, and quote posts and "p" tags for notifications.

## The "n" tag
It means reply a[n]cestor. The ordered "n" tag set lists all ancestors of the reply event until reaching the root. Used in conjunction with one "l" tag to associate an event with another event as a **reply**.

Format: `["n", <event-id or event-address>, <relay-url>]`
- `<event-id or event-address>` address of the replied to event if replying to a [long-form content](https://github.com/nostr-protocol/nips/blob/master/23.md) or else regular event id is used.
- `<relay-url>` is the URL of a recommended relay associated with the referenced event. Clients SHOULD add a valid `<relay-URL>` field, but may instead leave it as `""`)

When replying to an event E, you MUST copy all E "n" tags, then MUST append to the end of the tag list another "n" tag with E's id as its value. After that, you MUST add an "l" tag with the new count number of n tags.

If not replying, the event is considered a root event. Root events don't have n tags and SHOULD have an "l" tag with value "0" to allow requesting just root events.

*Note: Reaction events ([NIP-25](https://github.com/nostr-protocol/nips/blob/master/25.md)) SHOULD copy "n" and "l" tags from the reacted to event to help with advanced queries.*

## The "l" tag
It means reply [l]evel. Used to tell at which level the reply note is. Its value MUST be equal to the number of "n" tags.

Format: `["l", <stringified level of the event in the reply tree>]`

A relay MAY limit events to a max level. As a recommendation, clients SHOULD keep 4 as a maximum depth ("l" tag as "4") by not appending a n tag if already at level "4".

### Example reply event
The example considers that an event with id 'jkl...' is replying to an event of id 'ghi...'. The event 'ghi...' is a reply to the event 'def...', which is a reply to the root event 'abc...':
```js
{
  id: 'jkl...',
  kind: 1,
  content: 'This is a reply example',
  /* created_at etc */ // ommitted other keys for brevity
  tags: [
    ['n', 'abc...', /* relay-url */], // root event id or address
    ['n', 'def...', /* relay-url */],
    ['n', 'ghi...', /* relay-url */], // replied to event id or address
    ['l', '3'], // In a zero-based counting, event 'jkl...' depth is 3
    ['p', 'pubkey of ghi... event'] // so to notify 'ghi...'s author
  ]
}
```

### Example client filter
"n" and "l" tags combined allow for advanced queries. The simplest one would be loading all thread at once and uses just the "n" tag:
```js
{
  kinds: [1],
  #n: [/* root id */] // if in possession of a non-root event, use the value of the first n tag
}
```

## The "e" tag
Used to **mention** another event i.e. when the note is a quote post or a repost, and the ID refers to the quoted event.

Format: `["e", <event-id>, <relay-url>]` where `<event-id>` is the id of the event being mentioned.

When a mention is made, the event content MUST include an index marker with the notation `#[index]` as specified in [NIP-08](https://github.com/nostr-protocol/nips/blob/master/08.md), where the index matches the position of the `"e"` tag in the tags array. Note that a repost is a quote post without a comment. For example, a **quote** post's content may look like `hello world\n#[0]`, while a **repost** would contain only `#[0]`.

## The "p" tag
Used in a text event contains the pubkey of the replied to or mentioned event, to notify its authors. "p" tags are also used in pubkey mentions as per [NIP-08](https://github.com/nostr-protocol/nips/blob/master/08.md).

Format: `["p", <pubkey>, <relay-url>]` where `<pubkey>` is the public key of the event being replied to or mentioned.

When replying to a text event E the reply event's "p" tag SHOULD contain the `"pubkey"` of the event being replied to so to notify the replied to event author. For example, given a text event authored by `a1` with "p" tags referencing `p1`, `p2`, `p3` then the "p" tags of the reply should be just `a1`.

Event mentions SHOULD also contain the `"pubkey"` of the event being mentioned so to notify mentioned event author.

*Note: To record who is involved in a reply thread, get the pubkeys from the events referenced on the "n" tags instead of adding the pubkeys to "p" tags. This is because adding "p" tags notifies the referenced pubkey owners.*

## The "pp" tag
It means silent public key. Used in place of "p" tags when the public key is being mentioned in the note's content but should not be notified (such as public key lists). It has the same format of regular "p" tags.

## Previous work
There were competing standards drafts that may still be in use by outdated clients. You can check them out on [10.md file git history](https://github.com/nostr-protocol/nips/commits/master/10.md).
