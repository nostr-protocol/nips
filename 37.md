NIP-37
======

Editable Short Notes
--------------------

`draft` `optional`

`Kind:1` notes turn editable by adding a `dd` tag set to `"@"` (meaning unique by `.created_at`, for events with the same pubkey/kind)
and by referencing it by `u` tag set to `"<event kind>:<event pubkey>:@<event created_at>"` when replying
and by fetching single note using the timestamp (`since` and `until` filter keys set to the same specific `.created_at` value
along with specific author and `kinds: [1]`).

These rules are based on [this PR](https://github.com/arthurfranca/nips/blob/editable/00.md).

This setup is better than using a regular [NIP-01](01.md) `d` tag because the latter makes the editable note resurface to the top of the
chronological feed after every edit, which usually isn't what followers that have already seen the note want.
The note author can still repost the edited event for awareness.

### Event Structure

Besides the `dd` tag, the `updated_at` tag set to the unix timestamp in seconds is also a requirement.
The most recent event version is the one with the highest `updated_at` tag value.

```jsonc
{
  "kind": 1,
  "tags": [
    ["dd", "@"], // required; it must be the first tag
    ["updated_at", "<unix timestamp in seconds>"] // required
  ],
  "content": "Hello world",
  "created_at": 1730901363
  // ...other fields
}
```

### Migration Path

Unsupporting clients don't need to migrate. However, for their users an edited note will look like a brand new
note with reset engagement (zero comments, reactions etc).

As it will be seen on next sections, complexity is shifted to clients that choose to support this NIP.

### Replying

A reply is made of two events. The first one is a regular `kind:1` note (no `dd` tag - not editable)
using [NIP-10](10.md) `e` tags to please unsupporting clients.

The second one is a [NIP-22](https://github.com/arthurfranca/nips/blob/comment/22.md) `kind:1111` event
using `U/u` tags instead of `E/e`
and it must have the same `.created_at` as the former one for deduplication,
because supporting clients will need to fetch both
reply kinds to see the whole conversation.
The NIP-22 event should only be generated when replying to editable `kind:1` notes (those with a `dd` tag).

The NIP-22 reply should also reference the twin reply of kind 1 with an `o` tag set to its id, which
could be used later to reply again (to the NIP-22 reply) with a regular `kind:1` (using NIP-10) to please unsupporting clients
in addition to the NIP-22's `kind:1111` event. That is, when replying to a NIP-22 with `K` tag set to `"1"`,
two events are also used.

#### TBD

We should think of making NIP-22 comments editable too.

They likewise would be referenced by `u` tag for replies of replies instead of by `e` tag.

Probably a good idea to make the `dd` tag for them be `"@u"` (instead of just `"@"`).
It would prevent an edit from making the reply migrate to another thread if maliciously changing the `u` tag value.

### Editing

The edited note keeps the same `.created_at` field value while updates the `updated_at` tag value.

New note versions should append a new `o` tag referencing the previous version id at every edit
to enable fetching replies that are `kind:1` events.

The client must issue a delete for the previous note version right after sending the new one,
because relays that don't recognize the `dd` tag meaning won't automatically replace the previous note.
