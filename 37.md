NIP-37
======

Event Changes
-------------

`draft` `optional`

Relays may support the verb `CHANGED`, which provides a mechanism for client to find out whether a replaceable event is changed or no.

## Motivation

if a client tries to cache users profiles and metadata, it needs to request whole event from its relays and check if they are newer than cached one which is wast of bandwidth. using this message type clients can provide and specific filter for one event and relay will respond with a latest version of given event. 

## Filters and return values

This NIP defines the verb `CHANGED`, which accepts a id and a list of filter from client.

```jsonc
["CHANGED", <subscription_id>, <filters_JSON>, ...]
```

where:

<subscription_id>: is a unique string same as what defined in [NIP-01](./01.md).

<filters_JSON>: is a list of filter pointing to one specific replaceable OR addressable event.

Response from relay will look like this:

```jsonc
["CHANGED", <subscription_id>, <timestamps>, ...]
```

where:

<subscription_id>: is the corresponding id of client request.

<timestamps>: timestamps of newest version of events in relay. timestamps are pointing to specific event for the filter on their position.

### Notes

Relays SHOULD use `0` as timestamp if requested event was not found.

Relays MAY reject requests for non-replaceable or non-addressable events or any not acceptable filter and respond with a NOTICE message.

## Examples

### Single profile update check

```jsonc
["CHANGED", <subscription_id>, {"kinds": [0], "pubkey": "badbdda507572b397852048ea74f2ef3ad92b1aac07c3d4e1dec174e8cdc962a"}]
["CHANGED", <subscription_id>, 1724958773]
```

### Multiple profile update check

```jsonc
["CHANGED", <subscription_id>, {"kinds": [0], "pubkey": "badbdda507572b397852048ea74f2ef3ad92b1aac07c3d4e1dec174e8cdc962a"}, {"kinds": [0], "pubkey": "bd4ae3e67e29964d494172261dc45395c89f6bd2e774642e366127171dfb81f5"}, {"kinds": [0], "pubkey": ""}]
["CHANGED", <subscription_id>, 1724958773, 1727247549, 0]
```
