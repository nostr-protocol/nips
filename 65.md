NIP-65
======

Relay List Metadata
-------------------

`draft` `optional`

This NIP defines a series of replaceable event kinds for advertising user relay preferences, each with a particular purpose. These events MUST include a list of `r` tags with relay URIs. The `.content` field is not used.

For example:

```json
{
  "kind": 10002,
  "tags": [
    ["r", "wss://alicerelay.example.com"],
    ["r", "wss://brando-relay.com"],
    ["r", "wss://expensive-relay.example2.com", "write"],
    ["r", "wss://nostr-relay.example.com", "read"]
  ],
  "content": "",
  ...other fields
}
```

Event kinds defined:

- Kind `10002` indicates a user's default relay selections. This kind's `r` tags SHOULD include a `read` or `write` mark
  indicating whether the author reads from or writes to the given relay. If the marker is omitted, the relay is used for
  both purposes.
- Kind `10050` indicates a user's messaging relay selections. This kind's `r` tags SHOULD include a `inbox` or `outbox`
  mark indicating whether the author reads from or writes to the given relay. If the marker is omitted, the relay is used for
  both purposes.

This NIP doesn't fully replace relay lists that are designed to configure a client's usage of relays (such as `kind:3` style relay lists). Clients MAY use other relay lists in situations where a `kind:10002` relay list cannot be found.

## Relay Selection

When seeking public, non-encrypted events authored by a user, Clients SHOULD use the `write` relays defined by the
user's `kind:10002`.

When seeking public, non-encrypted events where a given user was tagged, Clients SHOULD use the `read` relays defined by
the user's `kind:10002`.

When seeking private or encrypted events authored by a user, Clients SHOULD use the `outbox` relays defined by
the author's `kind:10050` event, falling back to the `write` relayd defined by author's `kind:10002` event.

When broadcasting a public event, Clients SHOULD:

- Broadcast the event to the `write` relays of the author
- Broadcast the event to all `read` relays of each tagged user
-
When broadcasting a private event, Clients SHOULD:

- Broadcast the event to the `outbox` relays of the author, falling back to the author's `write` relays
- Broadcast the event all `inbox` relays of the recipient, falling back to the author's `read` relays

## Motivation

The old model of using a fixed relay list per user centralizes in large relay operators:

  - Most users submit their posts to the same highly popular relays, aiming to achieve greater visibility among a broader audience
  - Many users are pulling events from a large number of relays in order to get more data at the expense of duplication
  - Events are being copied between relays, oftentimes to many different relays

This NIP allows Clients to connect directly with the most up-to-date relay set from each individual user, eliminating the need of broadcasting events to popular relays.

## Final Considerations

1. Clients SHOULD guide users to keep relay lists small (2-4 relays).
2. Clients SHOULD spread an author's relay metadata events to as many relays as viable.
3. Relay list events should primarily be used to advertise the user's preferred relays to others.
   A user's own client may use other heuristics for selecting relays for fetching data.
4. If a relay signals support for this NIP in their [NIP-11](11.md) document that means they're willing to accept relay list events from a broad range of users, not only their paying customers or whitelisted group.
5. Clients SHOULD deduplicate connections by normalizing relay URIs according to [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986#section-6).
