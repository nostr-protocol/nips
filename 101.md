NIP-101
=======

UPlanet: Decentralized Identity & Geographic Coordination
----------------------------------------------------------

`draft` `optional`

This NIP defines a comprehensive protocol for **decentralized identity management**, **geographic coordination**, and **verifiable credentials** on Nostr. It extends the Nostr protocol with four integrated systems:

1. **Hierarchical GeoKeys** - Nostr keypairs derived from geographic coordinates
2. **Decentralized Identity (DID)** - W3C-compliant identities stored as Nostr events
3. **Oracle System** - Multi-signature permit management using Web of Trust
4. **ORE System** - Environmental obligations attached to geographic cells

This NIP enables **geographically localized communication**, **self-sovereign identity**, **peer-validated credentials**, and **ecological commitment tracking** on a fully decentralized network.

## Motivation

Current Nostr implementations lack:
- **Geographic context** for location-based communication
- **Standardized identity documents** for self-sovereign identity
- **Verifiable credentials** for competence and authority
- **Environmental accountability** mechanisms

UPlanet solves these problems by providing a unified protocol that:
- ✅ Creates **localized Nostr feeds** (UMAP, SECTOR, REGION)
- ✅ Implements **W3C-compliant DIDs** on Nostr (no centralized registries)
- ✅ Enables **peer-validated licensing** (driver's license, professional certifications)
- ✅ Tracks **environmental commitments** with economic incentives
- ✅ Supports **constellation synchronization** across multiple relays

## Event Kinds

### DID Documents (kind:30800)

A special event with `kind:30800` "DID Document" stores W3C-compliant Decentralized Identifiers as Nostr addressable events.

> **Note:** We use kind 30800 instead of 30311 to avoid conflict with [NIP-53](53.md) (Live Event), which officially uses kind 30311.

```jsonc
{
  "kind": 30800,
  "tags": [
    ["d", "did"],
    ["t", "uplanet"],
    ["t", "did-document"]
  ],
  "content": "{JSON_DID_DOCUMENT}"
}
```

DID Document Structure:

```jsonc
{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/suites/ed25519-2020/v1"
  ],
  "id": "did:nostr:<hex_pubkey>",
  "verificationMethod": [{
    "id": "did:nostr:<hex_pubkey>#key-1",
    "type": "Ed25519VerificationKey2020",
    "controller": "did:nostr:<hex_pubkey>",
    "publicKeyMultibase": "z<base58btc_encoded_key>"
  }],
  "service": [
    {
      "id": "#ipfs-drive",
      "type": "IPFSDrive",
      "serviceEndpoint": "ipns://<ipfs_key>/<email>/APP"
    },
    {
      "id": "#g1-wallet",
      "type": "Ğ1Wallet",
      "serviceEndpoint": "g1:<g1_pubkey>"
    }
  ],
  "verifiableCredential": [
    {
      "@context": "https://www.w3.org/2018/credentials/v1",
      "id": "urn:uuid:...",
      "type": ["VerifiableCredential", "UPlanetLicense"],
      "issuer": "did:nostr:<authority_hex>",
      "credentialSubject": {
        "id": "did:nostr:<subject_hex>",
        "license": "PERMIT_ORE_V1"
      }
    }
  ],
  "metadata": {
    "email": "user@example.com",
    "contractStatus": "active",
    "created": "2024-01-01T12:00:00Z",
    "updated": "2025-10-30T14:30:00Z"
  }
}
```

**DID Resolution:**
- **Format:** `did:nostr:<hex_pubkey>`
- **Query:** Subscribe to `kind:30800` events where `pubkey == <hex_pubkey>`
- **Verification:** Use the embedded `verificationMethod` to verify signatures

### Oracle System (kinds:30500-30503)

The Oracle System enables **peer-validated certification** using the Web of Trust model.

#### Permit Definition (kind:30500)

Defines a license or permit type that can be requested by users and validated by peers.

```jsonc
{
  "kind": 30500,
  "pubkey": "<UPLANETNAME_G1_hex>",
  "tags": [
    ["d", "PERMIT_ORE_V1"],
    ["t", "uplanet"],
    ["t", "permit"],
    ["t", "definition"]
  ],
  "content": "{
    \"id\": \"PERMIT_ORE_V1\",
    \"name\": \"ORE Environmental Verifier\",
    \"description\": \"Authority to verify ORE contracts\",
    \"min_attestations\": 5,
    \"valid_duration_days\": 1095,
    \"reward_zen\": 10
  }"
}
```

Implementations MAY also include tags such as `["l", "<permit_id>", "permit_type"]` (NIP-33) and optional `["permit", "PERMIT_ID"]` for filtering. Content MAY include `issuer_did`, `required_license`, `revocable`, `verification_method`, and `metadata` (see [NIP-42 Oracle Permits extension](42-oracle-permits-extension.md)).

#### Permit Request (kind:30501)

A user requesting a permit submits their application with evidence.

```jsonc
{
  "kind": 30501,
  "pubkey": "<applicant_hex>",
  "tags": [
    ["d", "<request_id>"],
    ["l", "PERMIT_ORE_V1", "permit_type"],
    ["p", "<applicant_hex>"],
    ["t", "uplanet"],
    ["t", "permit"],
    ["t", "request"]
  ],
  "content": "{
    \"request_id\": \"<request_id>\",
    \"permit_definition_id\": \"PERMIT_ORE_V1\",
    \"applicant_did\": \"did:nostr:<applicant_hex>\",
    \"statement\": \"I have expertise in ecological validation\",
    \"evidence\": [\"ipfs://Qm...\"],
    \"status\": \"pending\"
  }"
}
```

#### Permit Attestation (kind:30502)

Existing permit holders attest to the competence of applicants.

```jsonc
{
  "kind": 30502,
  "pubkey": "<attester_hex>",
  "tags": [
    ["d", "<attestation_id>"],
    ["e", "<request_event_id>"],
    ["p", "<applicant_hex>"],
    ["permit", "PERMIT_ORE_V1"],
    ["t", "uplanet"],
    ["t", "permit"],
    ["t", "attestation"]
  ],
  "content": "{
    \"attestation_id\": \"<attestation_id>\",
    \"request_id\": \"<request_event_id>\",
    \"attester_did\": \"did:nostr:<attester_hex>\",
    \"statement\": \"I attest to this applicant's competence\",
    \"signature\": \"<schnorr_signature>\"
  }"
}
```

The `p` tag MUST reference the **applicant** (subject of the attestation), not the attester (who is the event `pubkey`).

#### Permit Credential (kind:30503)

When sufficient attestations are collected, the Oracle issues a W3C Verifiable Credential.

```jsonc
{
  "kind": 30503,
  "pubkey": "<UPLANETNAME_G1_hex>",
  "tags": [
    ["d", "<credential_id>"],
    ["l", "PERMIT_ORE_V1", "permit_type"],
    ["p", "<holder_hex>"],
    ["t", "permit"],
    ["t", "credential"],
    ["t", "verifiable-credential"]
  ],
  "content": "{
    \"credential_id\": \"<credential_id>\",
    \"permit_definition_id\": \"PERMIT_ORE_V1\",
    \"holder_did\": \"did:nostr:<holder_hex>\",
    \"issued_by\": \"did:nostr:<UPLANETNAME_G1_hex>\",
    \"issued_at\": \"2025-10-30T12:00:00Z\",
    \"expires_at\": \"2028-10-30T12:00:00Z\",
    \"attestations\": 5,
    \"proof\": { \"type\": \"Schnorr\", \"signature\": \"...\" },
    \"status\": \"issued\"
  }"
}
```

Implementations MAY also store or expose a full W3C Verifiable Credential form; the content above is the canonical NOSTR payload. Optional tag `["permit", "PERMIT_ID"]` MAY be used for filtering.

**WoT Bootstrap ("Block 0"):**

For a permit requiring **N signatures**, register **N+1 members** on the station. Each member attests all other members (except themselves), resulting in each member receiving **N attestations**. The Oracle then issues credentials to all members simultaneously.

### ORE System (kinds:30312-30313)

The ORE (Obligations Réelles Environnementales) System attaches **environmental obligations** to geographic cells (UMAP), creating a decentralized ecological registry.

> **Note:** Kinds 30312 and 30313 are also used in [NIP-53](53.md) for Interactive Rooms and Conference Events. The ORE system extends NIP-53's meeting space concepts for environmental verification purposes, maintaining compatibility while adding geographic and ecological metadata.

#### ORE Meeting Space (kind:30312)

Defines a persistent geographic space for ORE verification meetings.

```jsonc
{
  "kind": 30312,
  "pubkey": "<UMAP_hex>",
  "tags": [
    ["d", "ore-space-43.60-1.44"],
    ["g", "43.60,1.44"],
    ["room", "UMAP_ORE_43.60_1.44"],
    ["t", "uplanet"],
    ["t", "ore-space"]
  ],
  "content": "{
    \"description\": \"Persistent geographic space for ORE verifications\",
    \"vdo_url\": \"https://vdo.ninja/?room=UMAP_ORE_43.60_1.44\",
    \"contractId\": \"ORE-2025-001\",
    \"provider\": \"did:nostr:<verifier_hex>\"
  }"
}
```

#### ORE Verification Meeting (kind:30313)

Represents a scheduled or completed verification meeting for environmental compliance.

```jsonc
{
  "kind": 30313,
  "pubkey": "<expert_hex>",
  "tags": [
    ["d", "ore-verification-43.60-1.44-1730289600"],
    ["a", "30312:<authority>:ore-space-43.60-1.44"],
    ["g", "43.60,1.44"],
    ["start", "1730289600"],
    ["permit", "PERMIT_ORE_V1"]
  ],
  "content": "{
    \"result\": \"compliant\",
    \"evidence\": \"ipfs://Qm...\",
    \"method\": \"satellite_imagery\",
    \"notes\": \"Forest cover: 82%\"
  }"
}
```

**Economic Flow:**
1. ORE Contract → UMAP DID (kind 30800)
2. ORE Meeting Space → NOSTR event (kind 30312)
3. Expert Validation → NOSTR event (kind 30313)
4. Automatic Payment → UPLANETNAME.RnD → UMAP Wallet
5. UMAP Redistribution → Local guardians/residents

### Other UPlanet event kinds (extensions)

The following kinds are used by UPlanet and synchronized in the constellation but are specified in separate extension documents:

| Kind(s) | Name | Extension |
|---------|------|-----------|
| 30850 | Economic Health Report | [101-economic-health-extension.md](101-economic-health-extension.md) |
| 30852 | Economic alert (planned) | [101-economic-health-extension.md](101-economic-health-extension.md) |
| 30904 | Crowdfunding campaign | [75-crowdfunding-extension.md](75-crowdfunding-extension.md) |
| 31900–31902 | Cookie workflow (definition, instance, completion) | [101-n2-constellation-sync-extension.md](101-n2-constellation-sync-extension.md) |
| 31910 | N² development memory (AI recommendations, TODOs) | [101-n2-constellation-sync-extension.md](101-n2-constellation-sync-extension.md) |

NIP-58 badge kinds (30009, 8) are emitted when Oracle credentials (30503) are issued; see [58-oracle-badges-extension.md](58-oracle-badges-extension.md).

## Hierarchical GeoKeys

Nostr keypairs are **deterministically derived** from geographic coordinates and a namespace string.

**Seed Format:**
```
"{UPLANETNAME}_{FORMATTED_LATITUDE}" "{UPLANETNAME}_{FORMATTED_LONGITUDE}"
```

Used as [libsodium](https://doc.libsodium.org/) salt & pepper for deterministic key generation.

### Grid Levels

| Level | Precision | Area Size | Example Seed |
|-------|-----------|-----------|--------------|
| **UMAP** | 0.01° | ~1.2 km² | `"UPlanetV148.85-2.34"` |
| **SECTOR** | 0.1° | ~100 km² | `"UPlanetV148.8-2.3"` |
| **REGION** | 1.0° | ~10,000 km² | `"UPlanetV148-2"` |

Each level generates a Nostr keypair (secp256k1), IPFS key (ed25519), Ğ1 wallet (ed25519), and Bitcoin address (secp256k1) from the same seed, creating a **Twin-Key** mechanism.

## Common Tags

All UPlanet events SHOULD include these tags:

### Geographic Tags
```json
["latitude", "FLOAT_STRING"]
["longitude", "FLOAT_STRING"]
["g", "<geohash>"]
["application", "UPlanet"]
```

### Identity Tags
```json
["did", "did:nostr:<hex_pubkey>"]
["t", "uplanet"]
```

### Permit Tags (30501-30503)
```json
["l", "PERMIT_ID", "permit_type"]
["permit", "PERMIT_ID"]
["e", "<related_event_id>"]
["p", "<applicant_or_holder_pubkey>"]
```
For kind 30502 (attestation), `p` MUST be the **applicant** (subject); for 30501 and 30503, `p` is the applicant or holder.

### ORE Tags (30312-30313)
```json
["d", "ore-space-{lat}-{lon}"]
["g", "{lat},{lon}"]
["room", "UMAP_ORE_{lat}_{lon}"]
```

## Implementation

### Authentication

All UPlanet API operations require **[NIP-42](42.md) authentication**.

### Key Management

**Twin-Key Mechanism:** From a single seed, generate:
- NOSTR keypair (identity)
- IPFS key (storage)
- Ğ1 wallet (economy)
- Bitcoin address (interoperability)

**Shamir Secret Sharing (SSSS):** Private keys are split into 3 fragments. Any 2 fragments can restore the full private key.

### Constellation Synchronization

UPlanet relays synchronize all NIP-101 events across the constellation network, including:

| Category | Kinds | Description |
|----------|-------|-------------|
| Core | 0, 1, 3, 5, 6, 7 | Metadata, notes, contacts, deletions, reactions |
| Media | 21, 22 | NIP-71 video (regular, short) |
| Files & comments | 1063, 1111, 1222, 1244, 1985, 1986 | NIP-94 files, NIP-22 comments, voice (NIP-A0), labeling |
| Content | 30023, 30024 | Long-form, articles |
| Channels | 40-44 | NIP-28 channels |
| Lists & status | 30001, 30005, 10001, 30315 | Bookmarks, playlists, lists |
| Identity | 30800 | DID Documents (this NIP) |
| Oracle | 30500-30503 | Permit definitions, requests, attestations, credentials |
| ORE | 30312-30313 | ORE meeting space, verification meeting |
| Economic | 30850 | Station economic health (see [101 Economic Health Extension](101-economic-health-extension.md)) |
| Workflows | 31900-31902 | Cookie workflow definition, instance, completion |
| N² Memory | 31910 | AI recommendations, Captain TODOs (see [101 N² Constellation Sync Extension](101-n2-constellation-sync-extension.md)) |
| Crowdfunding | 30904 | Multi-owner campaigns (see [75 Crowdfunding Extension](75-crowdfunding-extension.md)) |
| Analytics | 10000 | Analytics events |

**Total:** 40+ event types synchronized automatically.

## Use Cases

### 1. Localized Community Chat

Alice posts from her neighborhood UMAP:

```jsonc
{
  "kind": 1,
  "pubkey": "<alice_hex>",
  "tags": [
    ["p", "<UMAP_hex>"],
    ["latitude", "43.6047"],
    ["longitude", "1.4442"],
    ["application", "UPlanet"]
  ],
  "content": "Community garden meeting tomorrow at 10am!"
}
```

Bob, subscribed to that UMAP's `npub`, sees the message instantly.

### 2. ORE Verifier Certification

Carol wants to become an ORE verifier:
1. Carol requests PERMIT_ORE_V1
2. 5 experts attest Carol's competence
3. Oracle issues VC to Carol
4. VC added to Carol's DID
5. Carol receives 10 Ẑen reward
6. Carol can now validate ORE contracts

### 3. Environmental Commitment Tracking

Dave's UMAP commits to maintaining forest cover:
1. Create ORE Meeting Space (kind 30312)
2. Carol validates via satellite imagery
3. Carol publishes verification meeting (kind 30313)
4. System automatically triggers 10 Ẑen payment to Dave's UMAP
5. Dave redistributes to local guardians

## Security Considerations

### Location Disclosure
- **Risk:** Publishing precise coordinates reveals location
- **Mitigation:** Use broader grid levels (SECTOR, REGION) for privacy

### Permit Fraud
- **Risk:** Fake attestations or credential forgery
- **Mitigation:**
  - All events cryptographically signed (Schnorr)
  - Verify attester holds valid permit before accepting attestation
  - Multi-signature requirement (no single point of trust)

### Sybil Attacks
- **Risk:** Single entity creates multiple fake identities to self-attest
- **Mitigation:**
  - Require attesters to be in Ğ1 Web of Trust (verified humans)
  - Economic cost (Ẑen) for permit applications

## Compatibility

- ✅ Uses standard event kinds where possible (0, 1, 3, etc.)
- ✅ Follows [NIP-01](01.md) (Basic protocol)
- ✅ Implements [NIP-10](10.md) (`e` and `p` tags)
- ✅ Implements [NIP-33](33.md) (Parameterized Replaceable Events)
- ✅ Implements [NIP-42](42.md) (Authentication)
- ✅ DIDs follow W3C DID Core Specification
- ✅ Verifiable Credentials follow W3C VC Data Model

## References

### Related NIPs
- [NIP-01](01.md): Basic protocol flow
- [NIP-10](10.md): Conventions for `e` and `p` tags
- [NIP-33](33.md): Parameterized Replaceable Events
- [NIP-42](42.md): Authentication
- [NIP-53](53.md): Live Activities (uses kind 30311)
- [NIP-99](99.md): Classified Listings (uses kind 30402)

### W3C Standards
- [DID Core Specification](https://www.w3.org/TR/did-core/)
- [Verifiable Credentials Data Model](https://www.w3.org/TR/vc-data-model/)
- [Ed25519 Verification Key 2020](https://w3id.org/security/suites/ed25519-2020/v1)

### UPlanet Documentation
- **Main Repository:** [github.com/papiche/Astroport.ONE](https://github.com/papiche/Astroport.ONE)
- **NIP-101 Repository:** [github.com/papiche/NIP-101](https://github.com/papiche/NIP-101)
- **Public Portal:** [UPlanet - L'Internet de Confiance](https://ipfs.copylaradio.com/ipns/copylaradio.com)

## License

This specification is released under **AGPL-3.0**.

Implementation code is available at:
- [Astroport.ONE](https://github.com/papiche/Astroport.ONE) (AGPL-3.0)
- [NIP-101](https://github.com/papiche/NIP-101) (AGPL-3.0)
- [UPassport](https://github.com/papiche/UPassport) (AGPL-3.0)
- [UPlanet](https://github.com/papiche/UPlanet) (AGPL-3.0)

## Authors

**Lead Developers:**
- [papiche](https://github.com/papiche) - UPlanet & Astroport.ONE architecture
- CopyLaRadio SCIC - Cooperative governance and economic design

**Contributors:**
- Astroport.ONE community
- Ğ1 libre currency community
- NOSTR protocol community

